<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - iWATCH TV</title>
    <meta name="author" content="MiniMax Agent">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    
    <!-- Firebase Configuration - Replace with your Firebase config -->
    <script>
        // TODO: Replace with your actual Firebase configuration
        const firebaseConfig = {
            apiKey: "your-api-key",
            authDomain: "your-project.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project.appspot.com",
            messagingSenderId: "123456789",
            appId: "your-app-id"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        // Smart localStorage wrapper with cloud sync
        const smartStorage = {
            initialized: false,
            
            async initialize() {
                console.log('‚òÅÔ∏è Initializing smart storage...');
                try {
                    await db.collection('adminSettings').doc('connection').get();
                    this.initialized = true;
                    console.log('‚úÖ Cloud sync enabled');
                } catch (error) {
                    console.warn('‚ö†Ô∏è Cloud sync unavailable, using localStorage only');
                }
            },
            
            async setItem(key, value) {
                try {
                    // Always save to localStorage as primary storage
                    localStorage.setItem(key, typeof value === 'string' ? value : JSON.stringify(value));
                    
                    // Try to save to cloud if available
                    if (this.initialized && key.length < 50) { // Avoid very long keys
                        await db.collection('storage').doc(key).set({
                            value: value,
                            timestamp: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }
                } catch (error) {
                    console.warn('Storage operation failed:', error);
                }
            },
            
            async getItem(key) {
                try {
                    // Try to get from cloud first if available
                    if (this.initialized && key.length < 50) {
                        try {
                            const doc = await db.collection('storage').doc(key).get();
                            if (doc.exists) {
                                return doc.data().value;
                            }
                        } catch (error) {
                            console.warn('Cloud read failed:', error);
                        }
                    }
                    
                    // Fallback to localStorage
                    const value = localStorage.getItem(key);
                    return value ? JSON.parse(value) : null;
                } catch (error) {
                    console.warn('Get item failed:', error);
                    return localStorage.getItem(key);
                }
            },
            
            async removeItem(key) {
                try {
                    localStorage.removeItem(key);
                    if (this.initialized && key.length < 50) {
                        await db.collection('storage').doc(key).delete().catch(() => {});
                    }
                } catch (error) {
                    console.warn('Remove item failed:', error);
                }
            }
        };
        
        // Initialize smart storage when page loads
        document.addEventListener('DOMContentLoaded', () => {
            smartStorage.initialize();
        });
        
        // Override localStorage with cloud sync capability
        window.localStorage = {
            ...localStorage,
            setItem: (key, value) => {
                smartStorage.setItem(key, value);
            },
            getItem: async (key) => {
                const result = await smartStorage.getItem(key);
                return result;
            },
            removeItem: (key) => {
                smartStorage.removeItem(key);
                localStorage.removeItem(key); // Always remove from localStorage too
            }
        };
        
        // Global cloud sync functions for compatibility
        const cloudSync = {
            saveData: (collection, docId, data) => smartStorage.setItem(`${collection}_${docId}`, data),
            loadData: (collection, docId) => smartStorage.getItem(`${collection}_${docId}`)
        };
    </script>
    
    <!-- Enhanced Password Management System -->
    <script>
        const passwordManager = {
            passwords: {
                'adminLogin': 'admin123',
                'masterPassword': 'master2025' // Master password to access any reseller panel
            },
            resellerCredentials: {}, // Store reseller credentials by ID
            currentSession: null,
            
            initialize: function() {
                console.log('üîß PasswordManager initializing...');
                this.initializeCredentials();
                console.log('‚úÖ PasswordManager initialized');
            },
            
            initializeCredentials: function() {
                // Load existing credentials
                const savedCredentials = localStorage.getItem('resellerCredentials');
                if (savedCredentials) {
                    try {
                        this.resellerCredentials = JSON.parse(savedCredentials);
                    } catch (e) {
                        console.error('Error loading reseller credentials:', e);
                        this.resellerCredentials = {};
                    }
                } else {
                    // Create default reseller
                    this.resellerCredentials['reseller'] = {
                        username: 'reseller',
                        password: 'reseller123',
                        createdAt: new Date().toISOString()
                    };
                    this.saveCredentials();
                }
            },
            
            saveCredentials: function() {
                try {
                    console.log('üíæ Saving credentials to cloud + localStorage...');
                    smartStorage.setItem('resellerCredentials', this.resellerCredentials);
                    smartStorage.setItem('adminPasswords', this.passwords);
                    console.log('‚úÖ Credentials saved successfully with cloud sync');
                } catch (e) {
                    console.error('‚ùå Error saving credentials:', e);
                    throw e;
                }
            },
            
            verifyPassword: function(key, input) {
                return this.passwords[key] === input;
            },
            
            authenticateUser: function(username, password) {
                // Admin authentication
                if (username === 'admin' && password === this.passwords.adminLogin) {
                    this.currentSession = {
                        id: 'admin_' + Date.now(),
                        username: 'admin',
                        role: 'admin',
                        plan: 'Admin Access',
                        expiryDate: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000),
                        status: 'active',
                        permissions: ['admin', 'full_control']
                    };
                    return this.currentSession;
                }
                
                // Master password access to reseller panels
                if (password === this.passwords.masterPassword && username.startsWith('reseller_')) {
                    const resellerId = username.replace('reseller_', '');
                    if (this.resellerCredentials[resellerId]) {
                        return {
                            id: 'master_' + resellerId + '_' + Date.now(),
                            username: 'reseller_' + resellerId,
                            role: 'reseller',
                            resellerId: resellerId,
                            plan: 'Master Access',
                            expiryDate: new Date(Date.now() + 24 * 60 * 60 * 1000),
                            status: 'active',
                            permissions: ['reseller', 'master_access']
                        };
                    }
                }
                
                // Regular reseller authentication
                if (this.resellerCredentials[username]) {
                    const reseller = this.resellerCredentials[username];
                    if (reseller.password === password) {
                        this.currentSession = {
                            id: 'reseller_' + username + '_' + Date.now(),
                            username: username,
                            role: 'reseller',
                            resellerId: username,
                            plan: 'Reseller Access',
                            expiryDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000),
                            status: 'active',
                            permissions: ['reseller']
                        };
                        return this.currentSession;
                    }
                }
                
                return null;
            },
            
            changeAdminPassword: function(currentPassword, newPassword) {
                if (currentPassword !== this.passwords.adminLogin) {
                    return { success: false, message: 'Current password is incorrect' };
                }
                
                if (!newPassword || newPassword.length < 6) {
                    return { success: false, message: 'New password must be at least 6 characters' };
                }
                
                this.passwords.adminLogin = newPassword;
                this.saveCredentials(); // Save to localStorage
                return { success: true, message: 'Admin password updated successfully!' };
            },
            
            changeMasterPassword: function(currentPassword, newPassword) {
                if (currentPassword !== this.passwords.masterPassword) {
                    return { success: false, message: 'Current master password is incorrect' };
                }
                
                if (!newPassword || newPassword.length < 6) {
                    return { success: false, message: 'New master password must be at least 6 characters' };
                }
                
                this.passwords.masterPassword = newPassword;
                this.saveCredentials(); // Save to localStorage
                return { success: true, message: 'Master password updated successfully!' };
            },
            
            createReseller: function(resellerId, username, password) {
                console.log('üîß Creating reseller:', { resellerId, username, password });
                
                if (!resellerId || !username || !password) {
                    console.log('‚ùå Missing required fields');
                    return { success: false, message: 'All fields are required' };
                }
                
                if (this.resellerCredentials[resellerId]) {
                    console.log('‚ùå Reseller ID already exists:', resellerId);
                    return { success: false, message: 'Reseller ID already exists' };
                }
                
                if (password.length < 6) {
                    console.log('‚ùå Password too short');
                    return { success: false, message: 'Password must be at least 6 characters' };
                }
                
                this.resellerCredentials[resellerId] = {
                    username: username,
                    password: password,
                    createdAt: new Date().toISOString()
                };
                
                console.log('üíæ Saving credentials...', this.resellerCredentials[resellerId]);
                this.saveCredentials();
                
                // Verify saving worked
                const saved = localStorage.getItem('resellerCredentials');
                if (saved) {
                    try {
                        const parsed = JSON.parse(saved);
                        if (parsed[resellerId]) {
                            console.log('‚úÖ Credentials saved and verified');
                        } else {
                            console.error('‚ùå Credentials not found after save');
                        }
                    } catch (e) {
                        console.error('‚ùå Error verifying saved credentials:', e);
                    }
                } else {
                    console.error('‚ùå localStorage save failed');
                }
                
                return { success: true, message: `Reseller "${resellerId}" created successfully!` };
            },
            
            getAllResellers: function() {
                return Object.keys(this.resellerCredentials);
            }
        };
        
        // Initialize password system
        passwordManager.initializeCredentials();
        
        let isLoggedIn = false;
        let currentUser = null;
        
        function showLogin() {
            const overlay = document.getElementById('adminOverlay');
            const modal = document.getElementById('loginModal');
            overlay.style.display = 'flex';
            modal.style.display = 'block';
            document.getElementById('adminUsername').focus();
        }
        
        function hideLogin() {
            document.getElementById('adminOverlay').style.display = 'none';
            document.getElementById('loginModal').style.display = 'none';
        }
        
        function adminLogin() {
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;
            
            const user = passwordManager.authenticateUser(username, password);
            if (user) {
                isLoggedIn = true;
                currentUser = user;
                hideLogin();
                showSuccess(`Login successful! Welcome ${user.role === 'admin' ? 'Admin' : 'Master'} ${user.username}`);
            } else {
                showError('Invalid credentials');
                document.getElementById('adminPassword').value = '';
            }
        }
        
        function logout() {
            isLoggedIn = false;
            currentUser = null;
            showLogin();
        }
        
        function changeAdminPassword() {
            const currentPassword = prompt('Enter current admin password:');
            if (!currentPassword) return;
            
            const newPassword = prompt('Enter new admin password:');
            if (!newPassword || newPassword.length < 6) {
                showError('Password must be at least 6 characters');
                return;
            }
            
            const confirmPassword = prompt('Confirm new password:');
            if (newPassword !== confirmPassword) {
                showError('Passwords do not match');
                return;
            }
            
            const result = passwordManager.changeAdminPassword(currentPassword, newPassword);
            if (result.success) {
                showSuccess(result.message);
            } else {
                showError(result.message);
            }
        }
        
        function changeMasterPassword() {
            const currentPassword = prompt('Enter current master password:');
            if (!currentPassword) return;
            
            const newPassword = prompt('Enter new master password:');
            if (!newPassword || newPassword.length < 6) {
                showError('Password must be at least 6 characters');
                return;
            }
            
            const confirmPassword = prompt('Confirm new master password:');
            if (newPassword !== confirmPassword) {
                showError('Passwords do not match');
                return;
            }
            
            const result = passwordManager.changeMasterPassword(currentPassword, newPassword);
            if (result.success) {
                showSuccess(result.message);
            } else {
                showError(result.message);
            }
        }
        
        function createReseller() {
            // Get next available panel automatically
            const assignedPanel = getNextAvailablePanel();
            if (!assignedPanel) {
                showError('All 12 reseller panels are already assigned. Please remove a reseller first.');
                return;
            }
            
            const resellerId = `reseller_${assignedPanel}`;
            console.log(`üîß Auto-assigning reseller to Panel #${assignedPanel} (${resellerId})`);
            
            const username = prompt(`Creating reseller for Panel #${assignedPanel}\n\nEnter reseller username:`);
            if (!username) return;
            
            const password = prompt('Enter reseller password (min 6 characters):');
            if (!password) return;
            
            const result = passwordManager.createReseller(resellerId, username, password);
            if (result.success) {
                // Set panel assignment
                localStorage.setItem(`reseller_${resellerId}_panel`, assignedPanel);
                localStorage.setItem(`reseller_${assignedPanel}_assigned`, 'true');
                
                console.log(`‚úÖ Reseller ${resellerId} assigned to Panel #${assignedPanel}`);
                showSuccess(result.message);
                
                // Show access instructions with panel info
                setTimeout(() => {
                    showResellerAccessInstructions(resellerId, username, password, assignedPanel);
                }, 1500);
                
                showCreditSection(); // Refresh the credit section
                showResellersSection(); // Refresh the reseller list
            } else {
                showError(result.message);
            }
        }

        function getNextAvailablePanel() {
            for (let i = 1; i <= 12; i++) {
                const panelNum = String(i).padStart(3, '0');
                const resellerId = `reseller_${panelNum}`;
                
                if (!passwordManager.resellerCredentials[resellerId]) {
                    console.log(`üìã Found available panel: #${panelNum}`);
                    return panelNum;
                }
            }
            console.log('‚ùå No available panels found (001-012 all assigned)');
            return null; // All panels assigned
        }

        function showPanelAssignments() {
            const assignments = [];
            
            for (let i = 1; i <= 12; i++) {
                const panelNum = String(i).padStart(3, '0');
                const resellerId = `reseller_${panelNum}`;
                const assignedPanel = localStorage.getItem(`reseller_${resellerId}_panel`);
                
                if (passwordManager.resellerCredentials[resellerId]) {
                    const reseller = passwordManager.resellerCredentials[resellerId];
                    assignments.push(`Panel #${panelNum}: ${reseller.username} (${resellerId})`);
                } else {
                    assignments.push(`Panel #${panelNum}: AVAILABLE`);
                }
            }
            
            alert(`üìä PANEL ASSIGNMENTS STATUS\n\n${assignments.join('\n')}\n\nTotal: 12 panels (${assignments.filter(a => a.includes('AVAILABLE')).length} available)`);
        }

        function validatePanelAssignments() {
            console.log('üîç Validating panel assignments...');
            const resellers = passwordManager.getAllResellers();
            const assignments = [];
            
            resellers.forEach(resellerId => {
                const assignedPanel = localStorage.getItem(`reseller_${resellerId}_panel`);
                if (assignedPanel) {
                    assignments.push({ resellerId, assignedPanel });
                    console.log(`‚úÖ ${resellerId} ‚Üí Panel #${assignedPanel}`);
                } else {
                    console.log(`‚ùå ${resellerId} ‚Üí NO PANEL ASSIGNED`);
                }
            });
            
            return assignments;
        }

        function showResellerAccessInstructions(resellerId, username, password, assignedPanel) {
            const panelFile = `reseller_${assignedPanel}_panel.html`;
            const instructions = `
üéØ RESELLER ACCESS INSTRUCTIONS

üìã NEW RESELLER DETAILS:
‚Ä¢ Reseller ID: ${resellerId}
‚Ä¢ Username: ${username}
‚Ä¢ Password: ${password}
‚Ä¢ Assigned Panel: #${assignedPanel}
‚Ä¢ Panel File: ${panelFile}

üåê ACCESS YOUR PANEL:
‚Ä¢ Open: ${panelFile} (in your file browser)
‚Ä¢ Login with credentials above
‚Ä¢ Each panel works independently

‚úÖ FEATURES AVAILABLE:
‚Ä¢ Full customer management
‚Ä¢ Device selection (Basic TV, 2nd TV, 3rd TV)
‚Ä¢ Business rules validation
‚Ä¢ Automatic pricing calculation
‚Ä¢ Credit tracking
‚Ä¢ Package & add-on management

üìû IMPORTANT:
‚Ä¢ Your panel is unique to you (Panel #${assignedPanel})
‚Ä¢ Only you have access to your customer data
‚Ä¢ Admin manages all packages centrally

üîß ADMIN ACCESS:
‚Ä¢ Panel: admin_panel.html
‚Ä¢ Login: admin / [admin password]
‚Ä¢ Can change your credentials anytime

Press OK to close this window.
`;
            
            alert(instructions);
        }
        
        function showResellerAccessInstructions(resellerId, username, password) {
            const panelFile = `${resellerId}_panel.html`;
            const instructions = `
üéØ RESELLER ACCESS INSTRUCTIONS

üìã NEW RESELLER DETAILS:
‚Ä¢ Reseller ID: ${resellerId}
‚Ä¢ Username: ${username}
‚Ä¢ Password: ${password}
‚Ä¢ Panel File: ${panelFile}

üåê ACCESS PANEL:
‚Ä¢ Open: ${panelFile}
‚Ä¢ Login with the credentials above

‚úÖ FEATURES INCLUDED:
‚Ä¢ Full customer management
‚Ä¢ Device selection (Basic TV, 2nd TV, 3rd TV)
‚Ä¢ Business rules validation
‚Ä¢ Automatic pricing calculation
‚Ä¢ Credit tracking
‚Ä¢ Package & add-on management
‚Ä¢ Connected to admin system for packages/prices

üìû NEXT STEPS:
1. Share credentials with your reseller
2. Reseller opens ${panelFile}
3. Login with provided username/password
4. Start managing customers immediately!

üîó Your panel is ready: ${panelFile}
            `;
            
            alert(instructions);
            
            // Also update the reseller credentials section
            updateResellerCredentialsDisplay();
        }
        
        function showResellerCredentials() {
            const resellers = passwordManager.getAllResellers();
            let info = 'üîê RESELLER CREDENTIALS & ACCESS GUIDE\n\n';
            info += 'üåê RESELLER PANEL ACCESS:\n';
            info += 'File: reseller_panel_fixed.html\n\n';
            info += 'üë§ ADMIN ACCESS:\n';
            info += 'Admin Login: admin / [current admin password]\n\n';
            info += 'üìã EXISTING RESELLERS:\n';
            
            resellers.forEach(resellerId => {
                const reseller = passwordManager.resellerCredentials[resellerId];
                info += `\n${resellerId}:\n`;
                info += `  Username: ${reseller.username}\n`;
                info += `  Password: ${reseller.password}\n`;
                info += `  Created: ${new Date(reseller.createdAt).toLocaleDateString()}\n`;
                info += `  Panel: ${resellerId}_panel.html\n`;
            });
            
            info += '\nüìù INSTRUCTIONS FOR RESELLERS:\n';
            info += '1. Open your specific panel file (e.g., reseller_001_panel.html)\n';
            info += '2. Login with provided credentials\n';
            info += '3. Access all features including device selection\n';
            info += '4. Manage customers and track credits\n';
            
            alert(info);
        }
        
        function updateResellerCredentialsDisplay() {
            // This function can be expanded to update a dedicated UI section
            // showing all reseller information and access details
            const resellers = passwordManager.getAllResellers();
            if (resellers.length > 0) {
                showResellerCredentials();
            }
        }
        
        function manageResellerCredentials() {
            const resellers = passwordManager.getAllResellers();
            if (resellers.length === 0) {
                showError('No resellers found. Create a reseller first.');
                return;
            }
            
            let options = 'Select reseller to manage:\n';
            resellers.forEach((resellerId, index) => {
                options += `${index + 1}. ${resellerId}\n`;
            });
            
            const choice = prompt(options + '\nEnter number (or Cancel):');
            if (!choice) return;
            
            const index = parseInt(choice) - 1;
            if (index < 0 || index >= resellers.length) {
                showError('Invalid selection');
                return;
            }
            
            const resellerId = resellers[index];
            const reseller = passwordManager.resellerCredentials[resellerId];
            
            const choice2 = prompt(`\nWhat do you want to do with ${resellerId}?\n1. Update Username\n2. Update Password\n3. Reset Both\n4. Delete Reseller\n\nEnter choice (1-4):`);
            
            if (!choice2) return;
            
            switch(choice2) {
                case '1':
                    const newUsername = prompt(`Current username: ${reseller.username}\nEnter new username:`);
                    if (newUsername && newUsername.trim()) {
                        reseller.username = newUsername.trim();
                        passwordManager.saveCredentials();
                        showSuccess(`Username updated for ${resellerId}`);
                    }
                    break;
                    
                case '2':
                    const newPassword = prompt(`Enter new password for ${reseller.username}:`);
                    if (newPassword && newPassword.length >= 6) {
                        reseller.password = newPassword;
                        passwordManager.saveCredentials();
                        showSuccess(`Password updated for ${resellerId}`);
                    } else {
                        showError('Password must be at least 6 characters');
                    }
                    break;
                    
                case '3':
                    const username = prompt(`Current username: ${reseller.username}\nEnter new username:`);
                    const password = prompt(`Enter new password for ${username}:`);
                    if (username && password && password.length >= 6) {
                        reseller.username = username.trim();
                        reseller.password = password;
                        passwordManager.saveCredentials();
                        showSuccess(`Credentials updated for ${resellerId}`);
                    } else {
                        showError('Invalid username or password too short');
                    }
                    break;
                    
                case '4':
                    const confirm = prompt(`Are you sure you want to delete ${resellerId}? This cannot be undone.\nType 'YES' to confirm:`);
                    if (confirm === 'YES') {
                        delete passwordManager.resellerCredentials[resellerId];
                        passwordManager.saveCredentials();
                        showSuccess(`Reseller ${resellerId} deleted`);
                    }
                    break;
                    
                default:
                    showError('Invalid choice');
            }
        }
        
        function showSuccess(message) {
            showNotification(message, 'success');
        }
        
        function showError(message) {
            showNotification(message, 'error');
        }
        
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 500;
                z-index: 10000;
                transition: all 0.3s ease;
                ${type === 'success' ? 'background: #4caf50;' : 'background: #f44336;'}
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
    </script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            --accent-blue: #667eea;
            --accent-purple: #764ba2;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --error-color: #f44336;
            --focus-color: #667eea;
            --admin-color: #4caf50;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--primary-gradient);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        .admin-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            min-height: 100vh;
        }

        .admin-sidebar {
            background: rgba(0, 0, 0, 0.8);
            padding: 30px 20px;
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--glass-border);
            position: relative;
            z-index: 10;
        }

        .admin-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--glass-border);
        }

        .admin-logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--admin-color), #66bb6a);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: bold;
            color: white;
            margin: 0 auto 15px;
            box-shadow: 0 15px 35px rgba(76, 175, 80, 0.4);
        }

        .admin-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--admin-color);
            margin-bottom: 5px;
        }

        .admin-subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .admin-nav {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 10px;
        }

        .nav-btn {
            width: 100%;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            padding: 15px 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
            font-weight: 500;
            text-align: left;
        }

        .nav-btn:hover {
            background: rgba(76, 175, 80, 0.2);
            border-color: var(--admin-color);
            transform: translateX(5px);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, var(--admin-color), #66bb6a);
            border-color: transparent;
            color: white;
        }

        .nav-icon {
            font-size: 18px;
        }

        .admin-main {
            padding: 40px;
            overflow-y: auto;
            margin-left: 300px; /* Account for sidebar width */
        }

        .dashboard-header {
            margin-bottom: 40px;
        }

        .dashboard-title {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        .dashboard-subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(20px);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 15px;
        }

        .stat-icon.users {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .stat-icon.revenue {
            background: linear-gradient(135deg, #4caf50, #66bb6a);
        }

        .stat-icon.content {
            background: linear-gradient(135deg, #ff9800, #ffb74d);
        }

        .stat-icon.system {
            background: linear-gradient(135deg, #9c27b0, #ba68c8);
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .section-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
        }

        .section-card {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(20px);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--admin-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Content Management Styles */
        .content-tab {
            background: none;
            border: none;
            color: rgba(255,255,255,0.7);
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .content-tab.active {
            color: var(--admin-color);
            border-bottom-color: var(--admin-color);
        }

        .content-tab:hover {
            color: rgba(255,255,255,0.9);
        }

        .content-tab-content {
            animation: fadeIn 0.3s ease;
        }

        .content-item {
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .content-item:hover {
            background: rgba(0,0,0,0.4);
            border-color: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .content-thumbnail {
            flex-shrink: 0;
        }

        .content-details {
            flex: 1;
            min-width: 0;
        }

        .content-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: white;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .content-meta {
            font-size: 0.9rem;
            color: rgba(255,255,255,0.7);
            margin-bottom: 5px;
        }

        .content-url {
            font-size: 0.8rem;
            color: rgba(255,255,255,0.5);
            font-family: monospace;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .content-description {
            font-size: 0.85rem;
            color: rgba(255,255,255,0.7);
            margin-top: 4px;
            line-height: 1.3;
        }

        .content-actions {
            display: flex;
            gap: 10px;
            flex-shrink: 0;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-icon {
            font-size: 1.8rem;
        }

        .user-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .user-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--admin-color), #66bb6a);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }

        .user-details h4 {
            font-size: 14px;
            margin-bottom: 2px;
        }

        .user-details p {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .user-status {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 600;
        }

        .status-active {
            background: rgba(76, 175, 80, 0.2);
            color: var(--success-color);
        }

        .status-expiring {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }

        .status-expired {
            background: rgba(244, 67, 54, 0.2);
            color: var(--error-color);
        }

        .action-btn {
            background: var(--admin-color);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            background: #66bb6a;
            transform: scale(1.05);
        }

        /* Delete button styling */
        .action-btn-delete {
            background: #f44336;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn-delete:hover {
            background: #d32f2f;
            transform: scale(1.05);
        }

        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .content-item {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .content-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.2);
        }

        .content-thumbnail {
            width: 100%;
            height: 120px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .content-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .content-meta {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--admin-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .back-btn:hover {
            background: #66bb6a;
            transform: scale(1.05);
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--admin-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #66bb6a;
        }
    </style>
    
    <!-- Mobile Responsive CSS -->
    <style>
        /* Mobile Responsive Design */
        @media (max-width: 768px) {
            .admin-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
            }
            
            .admin-sidebar {
                width: 100%;
                padding: 15px;
                position: fixed;
                top: 0;
                left: 0;
                z-index: 1000;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                height: 100vh;
                overflow-y: auto;
            }
            
            .admin-sidebar.active {
                transform: translateX(0);
            }
            
            .admin-main {
                padding: 20px 15px;
                margin-left: 0;
            }
            
            .mobile-menu-toggle {
                display: block;
                position: fixed;
                top: 15px;
                right: 15px;
                z-index: 1001;
                background: var(--admin-color);
                color: white;
                border: none;
                padding: 12px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 18px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.2);
                font-size: 16px;
                width: 50px;
                height: 50px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            /* Hide mobile menu toggle on desktop */
            .mobile-menu-toggle {
                display: none;
            }
            
            .content-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }
            
            .package-card, .user-card, .addon-card, .reseller-card {
                padding: 15px;
                margin-bottom: 10px;
            }
            
            .dashboard-title {
                font-size: 1.5rem;
                margin-bottom: 15px;
            }
            
            .nav-btn {
                padding: 12px 15px;
                font-size: 14px;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 14px;
                width: 100%;
                margin-bottom: 10px;
            }
            
            input, select, textarea {
                padding: 12px;
                font-size: 16px; /* Prevents zoom on iOS */
            }
            
            .modal-content {
                width: 95%;
                max-width: none;
                margin: 20px;
                max-height: 90vh;
                overflow-y: auto;
            }
            
            .content-tabs {
                display: flex;
                flex-direction: column;
                gap: 5px;
            }
            
            .content-tab {
                text-align: left;
                padding: 10px 12px;
                font-size: 14px;
            }
            
            .content-item {
                padding: 15px;
                margin-bottom: 10px;
            }
            
            .content-item img {
                width: 50px;
                height: 50px;
            }
            
            .content-name {
                font-size: 14px;
                font-weight: 600;
            }
            
            .content-meta {
                font-size: 11px;
            }
            
            .action-btn {
                padding: 8px 12px;
                font-size: 12px;
                margin: 2px;
            }
        }
        
        @media (max-width: 480px) {
            .admin-main {
                padding: 15px 10px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-title {
                font-size: 1.3rem;
            }
            
            .modal-content {
                width: 98%;
                margin: 10px;
                padding: 15px;
            }
            
            .form-group {
                margin-bottom: 15px;
            }
            
            input, select, textarea {
                padding: 10px;
            }
            
            .btn {
                padding: 10px 16px;
                font-size: 13px;
            }
        }
        
        /* Touch-friendly improvements */
        @media (hover: none) and (pointer: coarse) {
            .nav-btn, .btn, .action-btn {
                min-height: 44px; /* iOS touch target */
            }
            
            .content-tab {
                min-height: 44px;
                display: flex;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="window.location.href='CLIENT_INTERFACE.html'">‚Üê Back to Client</button>
    <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">‚ò∞</button>
    
    <div class="admin-container">
        <div class="admin-sidebar" id="mobileSidebar">
            <div class="admin-header">
                <div class="admin-logo">üîß</div>
                <div class="admin-title">Admin Panel</div>
                <div class="admin-subtitle">System Management</div>
            </div>
            
            <ul class="admin-nav">
                <li class="nav-item">
                    <button class="nav-btn active" onclick="showSection('dashboard')">
                        <span class="nav-icon">üìä</span>
                        Dashboard
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-btn" onclick="showSection('users')">
                        <span class="nav-icon">üë•</span>
                        User Management
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-btn" onclick="showSection('content')">
                        <span class="nav-icon">CONTENT</span>
                        Content Management
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-btn" onclick="showSection('packages')">
                        <span class="nav-icon">üì¶</span>
                        Package Management
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-btn" onclick="showSection('resellers')">
                        <span class="nav-icon">üè¢</span>
                        Reseller Management
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-btn" onclick="showSection('credit')">
                        <span class="nav-icon">üí≥</span>
                        Credit Manager
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-btn" onclick="showSection('analytics')">
                        <span class="nav-icon">üìà</span>
                        Analytics
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-btn" onclick="showSection('settings')">
                        <span class="nav-icon">‚öôÔ∏è</span>
                        System Settings
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-btn" onclick="changeAdminPassword()">
                        <span class="nav-icon">üîê</span>
                        Change Password
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-btn" onclick="showSection('logs')">
                        <span class="nav-icon">üìã</span>
                        System Logs
                    </button>
                </li>
            </ul>
        </div>
        
        <div class="admin-main">
            <div class="dashboard-header">
                <h1 class="dashboard-title">Admin Dashboard</h1>
                <p class="dashboard-subtitle">Complete system overview and management</p>
            </div>
            
            <!-- Dashboard Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon users">üë•</div>
                    <div class="stat-value">0</div>
                    <div class="stat-label">Active Users</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon revenue">üí∞</div>
                    <div class="stat-value">$0</div>
                    <div class="stat-label">Monthly Revenue</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon content">CONTENT</div>
                    <div class="stat-value">0</div>
                    <div class="stat-label">Content Items</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon system">üñ•Ô∏è</div>
                    <div class="stat-value">99.9%</div>
                    <div class="stat-label">System Uptime</div>
                </div>
            </div>
            
            <!-- Dynamic Content Sections -->
            <div id="dashboard-section" class="section-grid">
                <!-- Users Section -->
                <div class="section-card">
                    <h3 class="section-title">
                        <span class="section-icon">üë•</span>
                        Recent Users
                    </h3>
                    <div class="user-list">
                        <div style="text-align: center; padding: 40px; color: var(--text-secondary);">üë• No users found. Add customers to get started.</div>
                    </div>
                </div>
                
                <!-- Content Section -->
                <div class="section-card">
                    <h3 class="section-title">
                        <span class="section-icon">CONTENT</span>
                        Popular Content
                    </h3>
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary);">No content available. Add content to get started.</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function showSection(section) {
            // Update active nav button
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Hide all sections
            const allSections = document.querySelectorAll('.section-card');
            allSections.forEach(sec => {
                sec.style.display = 'none';
            });
            
            // Show specific sections based on selection
            const dashboardSection = document.getElementById('dashboard-section');
            
            switch(section) {
                case 'dashboard':
                    dashboardSection.style.display = 'grid';
                    break;
                case 'users':
                    showUsersSection();
                    break;
                case 'content':
                    showContentSection();
                    break;
                case 'packages':
                    showPackagesSection();
                    break;
                case 'resellers':
                    showResellersSection();
                    break;
                case 'analytics':
                    showAnalyticsSection();
                    break;
                case 'settings':
                    showSettingsSection();
                    break;
                case 'credit':
                    showCreditSection();
                    break;
                case 'logs':
                    showLogsSection();
                    break;
            }
        }
        
        function showUsersSection() {
            const mainContent = document.querySelector('.admin-main');
            mainContent.innerHTML = `
                <div class="dashboard-header">
                    <h1 class="dashboard-title">üë• User Management</h1>
                    <p class="dashboard-subtitle">Manage user accounts and subscriptions</p>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon users">üë•</div>
                        <div class="stat-value">${getTotalCustomers()}</div>
                        <div class="stat-label">Total Users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon users">‚úÖ</div>
                        <div class="stat-value">${getActiveCustomers()}</div>
                        <div class="stat-label">Active Subscribers</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon users">‚è∞</div>
                        <div class="stat-value">${getExpiringCustomers()}</div>
                        <div class="stat-label">Expiring Soon</div>
                    </div>
                </div>
                <div class="section-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 class="section-title">User Accounts</h3>
                        <button onclick="addNewCustomer()" style="background: linear-gradient(135deg, #4caf50, #66bb6a); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600;">‚ûï Add New Customer</button>
                    </div>
                    <div class="user-list">
                        ${generateUserList()}
                    </div>
                </div>
            `;
        }
        
        function showContentSection() {
            const mainContent = document.querySelector('.admin-main');
            
            // Initialize content if not exists
            if (!window.contentLibrary) {
                window.contentLibrary = {
                    channels: [],
                    vod: [],
                    plex: [],
                    tvPlatforms: [
                        {
                            name: "IMDb TV",
                            logo: "tv_platform_icon.png",
                            category: "Streaming Platform",
                            compatiblePlatforms: "Android TV, LG WebOS, Samsung Tizen, Roku, iOS",
                            status: "Active",
                            description: "Free streaming service with movies and TV shows"
                        }
                    ]
                };
            }
            
            const stats = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon content">CONTENT</div>
                        <div class="stat-value">${window.contentLibrary.channels.length}</div>
                        <div class="stat-label">Live Channels</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon content">MOVIE</div>
                        <div class="stat-value">${window.contentLibrary.vod.length}</div>
                        <div class="stat-label">VOD Items</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon content">MOBILE</div>
                        <div class="stat-value">${window.contentLibrary.plex.length}</div>
                        <div class="stat-label">Plex Libraries</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon content">DEVICES</div>
                        <div class="stat-value">${window.contentLibrary.tvPlatforms.length}</div>
                        <div class="stat-label">TV Platforms</div>
                    </div>
                </div>
            `;
            
            mainContent.innerHTML = `
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Content Management</h1>
                    <p class="dashboard-subtitle">Manage streaming content and categories</p>
                </div>
                
                ${stats}
                
                <div class="section-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 class="section-title">Content Library</h3>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="addChannelModal()" style="background: #2196f3; color: white; border: none; padding: 10px 16px; border-radius: 6px; cursor: pointer; font-weight: 500;">Add Channel</button>
                            <button onclick="addVODModal()" style="background: #ff9800; color: white; border: none; padding: 10px 16px; border-radius: 6px; cursor: pointer; font-weight: 500;">Add VOD</button>
                            <button onclick="addPlexModal()" style="background: #4caf50; color: white; border: none; padding: 10px 16px; border-radius: 6px; cursor: pointer; font-weight: 500;">Add Plex</button>
                            <button onclick="addTVPlatformModal()" style="background: #9c27b0; color: white; border: none; padding: 10px 16px; border-radius: 6px; cursor: pointer; font-weight: 500;">Add TV Platform</button>
                        </div>
                    </div>
                    
                    <!-- Content Tabs -->
                    <div style="display: flex; border-bottom: 1px solid rgba(255,255,255,0.2); margin-bottom: 20px;">
                        <button onclick="showContentTab('channels')" id="channelsTab" class="content-tab active">Live Channels (${window.contentLibrary.channels.length})</button>
                        <button onclick="showContentTab('vod')" id="vodTab" class="content-tab">VOD Content (${window.contentLibrary.vod.length})</button>
                        <button onclick="showContentTab('plex')" id="plexTab" class="content-tab">Plex Libraries (${window.contentLibrary.plex.length})</button>
                        <button onclick="showContentTab('tvPlatforms')" id="tvPlatformsTab" class="content-tab">TV Platforms (${window.contentLibrary.tvPlatforms.length})</button>
                    </div>
                    
                    <!-- Channels Content -->
                    <div id="channelsContent" class="content-tab-content">
                        ${window.contentLibrary.channels.length === 0 ? 
                            '<div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.6);">No channels added yet. Click "Add Channel" to get started.</div>' :
                            window.contentLibrary.channels.map(channel => `
                                <div class="content-item">
                                    <div class="content-thumbnail">
                                        <img src="${channel.logo || ''}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px; background: #333; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px;">
                                    </div>
                                    <div class="content-details">
                                        <div class="content-name">${channel.name}</div>
                                        <div class="content-meta">
                                            <span>${channel.category || 'General'}</span> ‚Ä¢ 
                                            <span>${channel.language || 'English'}</span> ‚Ä¢ 
                                            <span>${channel.status || 'Active'}</span>
                                        </div>
                                        <div class="content-url">${channel.url || 'No URL'}</div>
                                    </div>
                                    <div class="content-actions">
                                        <button onclick="editContent('channels', ${window.contentLibrary.channels.indexOf(channel)})" style="background: #2196f3; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; margin-right: 5px;">Edit</button>
                                        <button onclick="deleteContent('channels', ${window.contentLibrary.channels.indexOf(channel)})" style="background: #f44336; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">Delete</button>
                                    </div>
                                </div>
                            `).join('')
                        }
                    </div>
                    
                    <!-- VOD Content -->
                    <div id="vodContent" class="content-tab-content" style="display: none;">
                        ${window.contentLibrary.vod.length === 0 ? 
                            '<div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.6);">No VOD content added yet. Click "Add VOD" to get started.</div>' :
                            window.contentLibrary.vod.map(vod => `
                                <div class="content-item">
                                    <div class="content-thumbnail">
                                        <img src="${vod.thumbnail || ''}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px; background: #333; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px;">
                                    </div>
                                    <div class="content-details">
                                        <div class="content-name">${vod.title}</div>
                                        <div class="content-meta">
                                            <span>${vod.category || 'Movie'}</span> ‚Ä¢ 
                                            <span>${vod.year || 'N/A'}</span> ‚Ä¢ 
                                            <span>${vod.duration || 'N/A'}</span> ‚Ä¢ 
                                            <span>${vod.status || 'Active'}</span>
                                        </div>
                                        <div class="content-url">${vod.url || 'No URL'}</div>
                                    </div>
                                    <div class="content-actions">
                                        <button onclick="editContent('vod', ${window.contentLibrary.vod.indexOf(vod)})" style="background: #ff9800; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; margin-right: 5px;">Edit</button>
                                        <button onclick="deleteContent('vod', ${window.contentLibrary.vod.indexOf(vod)})" style="background: #f44336; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">Delete</button>
                                    </div>
                                </div>
                            `).join('')
                        }
                    </div>
                    
                    <!-- Plex Content -->
                    <div id="plexContent" class="content-tab-content" style="display: none;">
                        ${window.contentLibrary.plex.length === 0 ? 
                            '<div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.6);">No Plex libraries added yet. Click "Add Plex" to get started.</div>' :
                            window.contentLibrary.plex.map(plex => `
                                <div class="content-item">
                                    <div class="content-thumbnail">
                                        <img src="${plex.logo || ''}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px; background: #333; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px;">
                                    </div>
                                    <div class="content-details">
                                        <div class="content-name">${plex.name}</div>
                                        <div class="content-meta">
                                            <span>${plex.type || 'Library'}</span> ‚Ä¢ 
                                            <span>${plex.server || 'Unknown'}</span> ‚Ä¢ 
                                            <span>${plex.status || 'Active'}</span>
                                        </div>
                                        <div class="content-url">${plex.url || 'No URL'}</div>
                                    </div>
                                    <div class="content-actions">
                                        <button onclick="editContent('plex', ${window.contentLibrary.plex.indexOf(plex)})" style="background: #4caf50; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; margin-right: 5px;">Edit</button>
                                        <button onclick="deleteContent('plex', ${window.contentLibrary.plex.indexOf(plex)})" style="background: #f44336; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">Delete</button>
                                    </div>
                                </div>
                            `).join('')
                        }
                    </div>
                    
                    <!-- TV Platforms Content -->
                    <div id="tvPlatformsContent" class="content-tab-content" style="display: none;">
                        ${window.contentLibrary.tvPlatforms.length === 0 ? 
                            '<div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.6);">No TV platforms added yet. Click "Add TV Platform" to get started.</div>' :
                            window.contentLibrary.tvPlatforms.map(platform => `
                                <div class="content-item">
                                    <div class="content-thumbnail">
                                        <img src="${platform.logo || ''}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px; background: #333; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px;">
                                    </div>
                                    <div class="content-details">
                                        <div class="content-name">${platform.name}</div>
                                        <div class="content-meta">
                                            <span>${platform.category || 'Streaming Platform'}</span> ‚Ä¢ 
                                            <span>${platform.compatiblePlatforms || 'Universal'}</span> ‚Ä¢ 
                                            <span>${platform.status || 'Active'}</span>
                                        </div>
                                        <div class="content-description">${platform.description || 'No description available'}</div>
                                    </div>
                                    <div class="content-actions">
                                        <button onclick="editContent('tvPlatforms', ${window.contentLibrary.tvPlatforms.indexOf(platform)})" style="background: #9c27b0; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; margin-right: 5px;">Edit</button>
                                        <button onclick="deleteContent('tvPlatforms', ${window.contentLibrary.tvPlatforms.indexOf(platform)})" style="background: #f44336; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">Delete</button>
                                    </div>
                                </div>
                            `).join('')
                        }
                    </div>
                </div>
            `;
        }
        
        // Content management functions
        function showContentTab(tab) {
            // Hide all content
            document.querySelectorAll('.content-tab-content').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.content-tab').forEach(el => el.classList.remove('active'));
            
            // Show selected content
            document.getElementById(tab + 'Content').style.display = 'block';
            document.getElementById(tab + 'Tab').classList.add('active');
        }
        
        function addChannelModal() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); z-index: 10001; display: flex;
                align-items: center; justify-content: center; backdrop-filter: blur(10px);
            `;
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #1a1a2e, #16213e); padding: 0; border-radius: 20px; border: 1px solid rgba(255,255,255,0.2); width: 500px; height: 600px; display: flex; flex-direction: column;">
                    <div style="padding: 20px 40px; border-bottom: 1px solid rgba(255,255,255,0.2);">
                        <h2 style="color: white; margin: 0; text-align: center;">Add Live Channel</h2>
                    </div>
                    
                    <div style="flex: 1; padding: 20px 40px; overflow-y: auto;">
                        <form id="addChannelForm" style="height: 100%;">
                            <div style="display: flex; flex-direction: column; height: 100%;">
                                <div style="flex: 1;">
                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Channel Name *</label>
                                        <input type="text" id="channelName" required style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">
                                    </div>
                                    
                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Stream URL *</label>
                                        <input type="url" id="channelUrl" required style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;" placeholder="http://example.com/stream.m3u8">
                                    </div>
                                    
                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Category</label>
                                        <select id="channelCategory" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">
                                            <option value="News">News</option>
                                            <option value="Sports">Sports</option>
                                            <option value="Entertainment">Entertainment</option>
                                            <option value="Movies">Movies</option>
                                            <option value="Music">Music</option>
                                            <option value="Kids">Kids</option>
                                            <option value="Documentary">Documentary</option>
                                            <option value="General">General</option>
                                        </select>
                                    </div>
                                    
                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Language</label>
                                        <select id="channelLanguage" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">
                                            <option value="English">English</option>
                                            <option value="Spanish">Spanish</option>
                                            <option value="French">French</option>
                                            <option value="German">German</option>
                                            <option value="Arabic">Arabic</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                    
                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Logo URL (Optional)</label>
                                        <input type="url" id="channelLogo" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;" placeholder="http://example.com/logo.png">
                                    </div>
                                    
                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Status</label>
                                        <select id="channelStatus" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">
                                            <option value="Active">Active</option>
                                            <option value="Inactive">Inactive</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div style="display: flex; gap: 15px; margin-top: 20px;">
                                    <button type="button" onclick="closeModal()" style="flex: 1; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white; font-weight: 600; cursor: pointer;">Cancel</button>
                                    <button type="submit" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #2196f3, #42a5f5); border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer;">Add Channel</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.getElementById('channelName').focus();
            
            modal.querySelector('#addChannelForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const newChannel = {
                    name: document.getElementById('channelName').value,
                    url: document.getElementById('channelUrl').value,
                    category: document.getElementById('channelCategory').value,
                    language: document.getElementById('channelLanguage').value,
                    logo: document.getElementById('channelLogo').value,
                    status: document.getElementById('channelStatus').value
                };
                
                window.contentLibrary.channels.push(newChannel);
                closeModal();
                showContentSection();
                showSuccess(`Channel "${newChannel.name}" added successfully!`);
            });
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) closeModal();
            });
        }
        
        function addVODModal() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); z-index: 10001; display: flex;
                align-items: center; justify-content: center; backdrop-filter: blur(10px);
            `;
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #1a1a2e, #16213e); padding: 0; border-radius: 20px; border: 1px solid rgba(255,255,255,0.2); width: 500px; height: 600px; display: flex; flex-direction: column;">
                    <div style="padding: 20px 40px; border-bottom: 1px solid rgba(255,255,255,0.2);">
                        <h2 style="color: white; margin: 0; text-align: center;">Add VOD Content</h2>
                    </div>
                    
                    <div style="flex: 1; padding: 20px 40px; overflow-y: auto;">
                        <form id="addVODForm" style="height: 100%;">
                            <div style="display: flex; flex-direction: column; height: 100%;">
                                <div style="flex: 1;">
                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Title *</label>
                                        <input type="text" id="vodTitle" required style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">
                                    </div>
                                    
                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Content URL *</label>
                                        <input type="url" id="vodUrl" required style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;" placeholder="http://example.com/video.mp4">
                                    </div>
                                    
                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Category</label>
                                        <select id="vodCategory" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">
                                            <option value="Movie">Movie</option>
                                            <option value="TV Series">TV Series</option>
                                            <option value="Documentary">Documentary</option>
                                            <option value="Sports">Sports</option>
                                            <option value="Kids">Kids</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                    
                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Year</label>
                                        <input type="number" id="vodYear" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;" placeholder="2024">
                                    </div>
                                    
                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Duration (minutes)</label>
                                        <input type="number" id="vodDuration" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;" placeholder="120">
                                    </div>
                                    
                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Thumbnail URL (Optional)</label>
                                        <input type="url" id="vodThumbnail" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;" placeholder="http://example.com/thumbnail.jpg">
                                    </div>
                                    
                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Status</label>
                                        <select id="vodStatus" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">
                                            <option value="Active">Active</option>
                                            <option value="Inactive">Inactive</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div style="display: flex; gap: 15px; margin-top: 20px;">
                                    <button type="button" onclick="closeModal()" style="flex: 1; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white; font-weight: 600; cursor: pointer;">Cancel</button>
                                    <button type="submit" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #ff9800, #ffb74d); border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer;">Add VOD</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.getElementById('vodTitle').focus();
            
            modal.querySelector('#addVODForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const newVOD = {
                    title: document.getElementById('vodTitle').value,
                    url: document.getElementById('vodUrl').value,
                    category: document.getElementById('vodCategory').value,
                    year: document.getElementById('vodYear').value,
                    duration: document.getElementById('vodDuration').value,
                    thumbnail: document.getElementById('vodThumbnail').value,
                    status: document.getElementById('vodStatus').value
                };
                
                window.contentLibrary.vod.push(newVOD);
                closeModal();
                showContentSection();
                showSuccess(`VOD "${newVOD.title}" added successfully!`);
            });
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) closeModal();
            });
        }
        
        function addPlexModal() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); z-index: 10001; display: flex;
                align-items: center; justify-content: center; backdrop-filter: blur(10px);
            `;
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #1a1a2e, #16213e); padding: 40px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.2); width: 500px;">
                    <h2 style="color: white; margin-bottom: 20px; text-align: center;">Add Plex Library</h2>
                    
                    <form id="addPlexForm">
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Library Name *</label>
                            <input type="text" id="plexName" required style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Plex URL *</label>
                            <input type="url" id="plexUrl" required style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;" placeholder="http://plex-server:32400">
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Library Type</label>
                            <select id="plexType" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">
                                <option value="Movies">Movies</option>
                                <option value="TV Shows">TV Shows</option>
                                <option value="Music">Music</option>
                                <option value="Photos">Photos</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Server Name</label>
                            <input type="text" id="plexServer" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;" placeholder="My Plex Server">
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Token (Optional)</label>
                            <input type="text" id="plexToken" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;" placeholder="Plex authentication token">
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Status</label>
                            <select id="plexStatus" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">
                                <option value="Active">Active</option>
                                <option value="Inactive">Inactive</option>
                            </select>
                        </div>
                        
                        <div style="display: flex; gap: 15px;">
                            <button type="button" onclick="closeModal()" style="flex: 1; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white; font-weight: 600; cursor: pointer;">Cancel</button>
                            <button type="submit" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #4caf50, #66bb6a); border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer;">Add Plex</button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.getElementById('plexName').focus();
            
            modal.querySelector('#addPlexForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const newPlex = {
                    name: document.getElementById('plexName').value,
                    url: document.getElementById('plexUrl').value,
                    type: document.getElementById('plexType').value,
                    server: document.getElementById('plexServer').value,
                    token: document.getElementById('plexToken').value,
                    status: document.getElementById('plexStatus').value
                };
                
                window.contentLibrary.plex.push(newPlex);
                closeModal();
                showContentSection();
                showSuccess(`Plex library "${newPlex.name}" added successfully!`);
            });
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) closeModal();
            });
        }
        
        function addTVPlatformModal() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); z-index: 10001; display: flex;
                align-items: center; justify-content: center; backdrop-filter: blur(10px);
            `;
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #1a1a2e, #16213e); padding: 40px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.2); width: 500px;">
                    <h2 style="color: white; margin-bottom: 20px; text-align: center;">Add TV Platform</h2>
                    
                    <form id="addTVPlatformForm">
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Platform Name *</label>
                            <input type="text" id="platformName" required style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;" placeholder="e.g., Netflix, Disney+, Prime Video">
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Logo URL *</label>
                            <input type="url" id="platformLogo" required style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;" placeholder="https://example.com/logo.png">
                            <small style="color: rgba(255,255,255,0.7); font-size: 12px;">Recommended size: 512x512px or 300x300px for optimal display on TV platforms</small>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Compatible TV Platforms</label>
                            <input type="text" id="platformCompatibility" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;" placeholder="Android TV, LG WebOS, Samsung Tizen, Roku, iOS">
                            <small style="color: rgba(255,255,255,0.7); font-size: 12px;">Comma-separated list of compatible TV platforms</small>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Category</label>
                            <select id="platformCategory" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">
                                <option value="Streaming Platform">Streaming Platform</option>
                                <option value="Free TV">Free TV</option>
                                <option value="Premium">Premium</option>
                                <option value="Sports">Sports</option>
                                <option value="Movies">Movies</option>
                                <option value="TV Shows">TV Shows</option>
                                <option value="Kids">Kids</option>
                                <option value="Music">Music</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Description</label>
                            <textarea id="platformDescription" rows="3" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;" placeholder="Brief description of the streaming platform..."></textarea>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Platform URL (Optional)</label>
                            <input type="url" id="platformUrl" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;" placeholder="https://platform-website.com">
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Status</label>
                            <select id="platformStatus" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">
                                <option value="Active">Active</option>
                                <option value="Inactive">Inactive</option>
                                <option value="Coming Soon">Coming Soon</option>
                            </select>
                        </div>
                        
                        <div style="display: flex; gap: 15px;">
                            <button type="button" onclick="closeModal()" style="flex: 1; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white; font-weight: 600; cursor: pointer;">Cancel</button>
                            <button type="submit" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #9c27b0, #ba68c8); border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer;">Add TV Platform</button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.getElementById('platformName').focus();
            
            modal.querySelector('#addTVPlatformForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const newPlatform = {
                    name: document.getElementById('platformName').value,
                    logo: document.getElementById('platformLogo').value,
                    category: document.getElementById('platformCategory').value,
                    compatiblePlatforms: document.getElementById('platformCompatibility').value,
                    description: document.getElementById('platformDescription').value,
                    url: document.getElementById('platformUrl').value,
                    status: document.getElementById('platformStatus').value
                };
                
                window.contentLibrary.tvPlatforms.push(newPlatform);
                closeModal();
                showContentSection();
                showSuccess(`TV Platform "${newPlatform.name}" added successfully!`);
            });
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) closeModal();
            });
        }
        
        function editContent(type, index) {
            const content = window.contentLibrary[type][index];
            
            // Special handling for TV Platforms
            if (type === 'tvPlatforms') {
                editTVPlatformModal(index);
                return;
            }
            
            // For other content types, show a simple alert for now
            alert(`Edit functionality for ${type}: ${content.name || content.title}\n\nThis would open an edit modal with the current values populated.`);
        }
        
        function editTVPlatformModal(index) {
            const platform = window.contentLibrary.tvPlatforms[index];
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); z-index: 10001; display: flex;
                align-items: center; justify-content: center; backdrop-filter: blur(10px);
            `;
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #1a1a2e, #16213e); padding: 40px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.2); width: 500px;">
                    <h2 style="color: white; margin-bottom: 20px; text-align: center;">Edit TV Platform</h2>
                    
                    <form id="editTVPlatformForm">
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Platform Name *</label>
                            <input type="text" id="editPlatformName" required style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;" value="${platform.name}">
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Logo URL *</label>
                            <input type="url" id="editPlatformLogo" required style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;" value="${platform.logo}">
                            <small style="color: rgba(255,255,255,0.7); font-size: 12px;">Recommended size: 512x512px or 300x300px for optimal display on TV platforms</small>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Compatible TV Platforms</label>
                            <input type="text" id="editPlatformCompatibility" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;" value="${platform.compatiblePlatforms || ''}">
                            <small style="color: rgba(255,255,255,0.7); font-size: 12px;">Comma-separated list of compatible TV platforms</small>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Category</label>
                            <select id="editPlatformCategory" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">
                                <option value="Streaming Platform" ${platform.category === 'Streaming Platform' ? 'selected' : ''}>Streaming Platform</option>
                                <option value="Free TV" ${platform.category === 'Free TV' ? 'selected' : ''}>Free TV</option>
                                <option value="Premium" ${platform.category === 'Premium' ? 'selected' : ''}>Premium</option>
                                <option value="Sports" ${platform.category === 'Sports' ? 'selected' : ''}>Sports</option>
                                <option value="Movies" ${platform.category === 'Movies' ? 'selected' : ''}>Movies</option>
                                <option value="TV Shows" ${platform.category === 'TV Shows' ? 'selected' : ''}>TV Shows</option>
                                <option value="Kids" ${platform.category === 'Kids' ? 'selected' : ''}>Kids</option>
                                <option value="Music" ${platform.category === 'Music' ? 'selected' : ''}>Music</option>
                                <option value="Other" ${platform.category === 'Other' ? 'selected' : ''}>Other</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Description</label>
                            <textarea id="editPlatformDescription" rows="3" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">${platform.description || ''}</textarea>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Platform URL (Optional)</label>
                            <input type="url" id="editPlatformUrl" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;" value="${platform.url || ''}">
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Status</label>
                            <select id="editPlatformStatus" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">
                                <option value="Active" ${platform.status === 'Active' ? 'selected' : ''}>Active</option>
                                <option value="Inactive" ${platform.status === 'Inactive' ? 'selected' : ''}>Inactive</option>
                                <option value="Coming Soon" ${platform.status === 'Coming Soon' ? 'selected' : ''}>Coming Soon</option>
                            </select>
                        </div>
                        
                        <div style="display: flex; gap: 15px;">
                            <button type="button" onclick="closeModal()" style="flex: 1; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white; font-weight: 600; cursor: pointer;">Cancel</button>
                            <button type="submit" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #9c27b0, #ba68c8); border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer;">Update Platform</button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.getElementById('editPlatformName').focus();
            
            modal.querySelector('#editTVPlatformForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const updatedPlatform = {
                    name: document.getElementById('editPlatformName').value,
                    logo: document.getElementById('editPlatformLogo').value,
                    category: document.getElementById('editPlatformCategory').value,
                    compatiblePlatforms: document.getElementById('editPlatformCompatibility').value,
                    description: document.getElementById('editPlatformDescription').value,
                    url: document.getElementById('editPlatformUrl').value,
                    status: document.getElementById('editPlatformStatus').value
                };
                
                window.contentLibrary.tvPlatforms[index] = updatedPlatform;
                closeModal();
                showContentSection();
                showSuccess(`TV Platform "${updatedPlatform.name}" updated successfully!`);
            });
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) closeModal();
            });
        }
        
        function deleteContent(type, index) {
            const content = window.contentLibrary[type][index];
            const contentName = content.name || content.title;
            
            if (confirm(`Are you sure you want to delete "${contentName}"?`)) {
                window.contentLibrary[type].splice(index, 1);
                showContentSection();
                showSuccess(`Content "${contentName}" deleted successfully!`);
            }
        }
        
        function closeModal() {
            const modal = document.querySelector('div[style*="z-index: 10001"]');
            if (modal) {
                modal.remove();
            }
        }
        
        function showPackagesSection() {
            const mainContent = document.querySelector('.admin-main');
            mainContent.innerHTML = `
                <div class="dashboard-header">
                    <h1 class="dashboard-title">üì¶ Package Management</h1>
                    <p class="dashboard-subtitle">Manage packages, addons, and pricing</p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon revenue">üì¶</div>
                        <div class="stat-value">${window.packages ? window.packages.length : 0}</div>
                        <div class="stat-label">Active Packages</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon revenue">üîß</div>
                        <div class="stat-value">${window.addons ? window.addons.length : 0}</div>
                        <div class="stat-label">Addons Available</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon revenue">DEVICES</div>
                        <div class="stat-value">3</div>
                        <div class="stat-label">Device Tiers</div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">
                    <!-- Package Management -->
                    <div class="section-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 class="section-title">üì¶ Packages</h3>
                            <div style="display: flex; gap: 10px;">
                                <button onclick="debugSaveAllPackages()" style="background: linear-gradient(135deg, #ff6b6b, #ff8e8e); color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 11px; font-weight: 600;">üêõ Debug Save</button>
                                <button onclick="addNewPackage()" style="background: linear-gradient(135deg, #4caf50, #66bb6a); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600;">‚ûï Add Package</button>
                            </div>
                        </div>
                        <div style="max-height: 300px; overflow-y: auto;">
                            ${generatePackageList()}
                        </div>
                    </div>
                    
                    <!-- Addon Management -->
                    <div class="section-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 class="section-title">üîß Addons</h3>
                            <button onclick="addNewAddon()" style="background: linear-gradient(135deg, #ff9800, #ffb74d); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600;">‚ûï Add Addon</button>
                        </div>
                        <div style="max-height: 300px; overflow-y: auto;">
                            ${generateAddonList()}
                        </div>
                    </div>
                </div>
                
                <!-- Device Pricing -->
                <div class="section-card" style="margin-top: 25px;">
                    <h3 class="section-title">Additional Device Pricing</h3>
                    <div style="text-align: center; margin-bottom: 15px; color: rgba(255,255,255,0.7); font-size: 14px;">1st TV is included in base subscription</div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                        <div style="background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; padding: 20px; text-align: center;">
                            <h4 style="color: white; margin-bottom: 10px;">2nd TV</h4>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #ff9800; margin-bottom: 10px;">$${window.devicePricing?.secondTV || 0}/month</div>
                            <button onclick="editDevicePrice('secondTV')" style="background: #ff9800; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 11px;">Edit Price</button>
                        </div>
                        <div style="background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; padding: 20px; text-align: center;">
                            <h4 style="color: white; margin-bottom: 10px;">3rd TV</h4>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #ff5722; margin-bottom: 10px;">$${window.devicePricing?.thirdTV || 0}/month</div>
                            <button onclick="editDevicePrice('thirdTV')" style="background: #ff5722; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 11px;">Edit Price</button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function showResellersSection() {
            const mainContent = document.querySelector('.admin-main');
            mainContent.innerHTML = `
                <div class="dashboard-header">
                    <h1 class="dashboard-title">üè¢ Reseller Management</h1>
                    <p class="dashboard-subtitle">Manage reseller accounts and commissions</p>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon revenue">üè¢</div>
                        <div class="stat-value">${Object.keys(creditSystem.resellerCredits).length}</div>
                        <div class="stat-label">Active Resellers</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon revenue">üí∞</div>
                        <div class="stat-value">$${getTotalResellerCredits()}</div>
                        <div class="stat-label">Total Credits</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon users">üë•</div>
                        <div class="stat-value">${getTotalResellerCustomers()}</div>
                        <div class="stat-label">Total Customers</div>
                    </div>
                </div>
                <div class="section-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 class="section-title">Reseller Accounts</h3>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="manageResellerCredentials()" style="background: linear-gradient(135deg, #ff9800, #ffb74d); color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 12px;">‚öôÔ∏è Manage Credentials</button>
                            <button onclick="showPanelAssignments()" style="background: linear-gradient(135deg, #9c27b0, #ba68c8); color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 12px;">üìä View Panels</button>
                            <button onclick="createReseller()" style="background: linear-gradient(135deg, #4caf50, #66bb6a); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600;">‚ûï Create New Reseller</button>
                        </div>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; padding: 15px; margin-bottom: 15px; font-size: 13px; color: rgba(255,255,255,0.8);">
                        <strong>üìã RESELLER SYSTEM:</strong><br>
                        ‚úÖ Each reseller gets their own panel file (reseller_XXX_panel.html)<br>
                        ‚úÖ All panels are exactly the same but work independently<br>
                        ‚úÖ Admin can change username/password for any reseller<br>
                        ‚úÖ Centralized package and pricing management
                    </div>
                    <div class="user-list">
                        ${generateResellerList()}
                    </div>
                </div>
            `;
        }
        
        function showAnalyticsSection() {
            const mainContent = document.querySelector('.admin-main');
            mainContent.innerHTML = `
                <div class="dashboard-header">
                    <h1 class="dashboard-title">üìà Analytics Dashboard</h1>
                    <p class="dashboard-subtitle">System performance and usage analytics</p>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon users">üë•</div>
                        <div class="stat-value">0</div>
                        <div class="stat-label">Monthly Active Users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon content">‚è∞</div>
                        <div class="stat-value">0h</div>
                        <div class="stat-label">Avg. Watch Time</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon system">üìä</div>
                        <div class="stat-value">94.2%</div>
                        <div class="stat-label">Streaming Quality</div>
                    </div>
                </div>
                <div class="section-card">
                    <h3 class="section-title">Performance Metrics</h3>
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <div style="font-size: 48px; margin-bottom: 15px;">üìà</div>
                        <div style="font-size: 18px; font-weight: 500;">Analytics Dashboard</div>
                        <div style="font-size: 14px; margin-top: 5px;">Detailed analytics and reporting features</div>
                    </div>
                </div>
            `;
        }
        
        function showSettingsSection() {
            const mainContent = document.querySelector('.admin-main');
            mainContent.innerHTML = `
                <div class="dashboard-header">
                    <h1 class="dashboard-title">‚öôÔ∏è System Settings</h1>
                    <p class="dashboard-subtitle">Configure system parameters and preferences</p>
                </div>
                <div class="section-grid">
                    <div class="section-card">
                        <h3 class="section-title">General Settings</h3>
                        <div style="padding: 20px 0;">
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">System Name</label>
                                <input type="text" value="iWATCH TV" style="width: 100%; padding: 10px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 8px; color: var(--text-primary);">
                            </div>
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Default Adult Password</label>
                                <input type="password" value="1818" style="width: 100%; padding: 10px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 8px; color: var(--text-primary);">
                            </div>
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Session Timeout</label>
                                <select style="width: 100%; padding: 10px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 8px; color: var(--text-primary);">
                                    <option>30 minutes</option>
                                    <option>1 hour</option>
                                    <option>2 hours</option>
                                    <option>4 hours</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="section-card">
                        <h3 class="section-title">Security Settings</h3>
                        <div style="padding: 20px 0;">
                            <div style="margin-bottom: 20px;">
                                <label style="display: flex; align-items: center; gap: 10px;">
                                    <input type="checkbox" checked> Enable adult content protection
                                </label>
                            </div>
                            <div style="margin-bottom: 20px;">
                                <label style="display: flex; align-items: center; gap: 10px;">
                                    <input type="checkbox" checked> Require password change
                                </label>
                            </div>
                            <div style="margin-bottom: 20px;">
                                <label style="display: flex; align-items: center; gap: 10px;">
                                    <input type="checkbox" checked> Enable session logging
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function showLogsSection() {
            const mainContent = document.querySelector('.admin-main');
            mainContent.innerHTML = `
                <div class="dashboard-header">
                    <h1 class="dashboard-title">üìã System Logs</h1>
                    <p class="dashboard-subtitle">Monitor system activity and errors</p>
                </div>
                <div class="section-card">
                    <h3 class="section-title">Recent Activity</h3>
                    <div style="font-family: 'Courier New', monospace; font-size: 12px; background: rgba(0,0,0,0.3); padding: 20px; border-radius: 8px; max-height: 400px; overflow-y: auto;">
                        ${generateSystemLogs()}
                    </div>
                </div>
            `;
        }
        
let customerIdCounter = 1;
        
        function generateUserList() {
            // Load customers from adminCustomers (supports both admin and reseller customers)
            const adminCustomers = JSON.parse(localStorage.getItem('adminCustomers') || '[]');
            
            if (adminCustomers.length === 0) {
                return '<div style="text-align: center; padding: 40px; color: var(--text-secondary);">üë• No customers found. Click "Add New Customer" to get started.</div>';
            }
            
            return adminCustomers.map(customer => {
                // Calculate days until expiry
                const statusInfo = calculateCustomerStatus(customer);
                const statusClass = statusInfo.className;
                const statusText = statusInfo.text;
                
                // Add reseller attribution display
                const resellerAttribution = customer.resellerId ? 
                    `<p style="color: #ff9800; font-size: 11px; margin-top: 2px;">üìç Reseller: ${customer.resellerId}</p>` : 
                    `<p style="color: #4caf50; font-size: 11px; margin-top: 2px;">üëë Admin Created</p>`;
                
                return `
                <div class="user-item">
                    <div class="user-info">
                        <div class="user-avatar">${customer.avatar}</div>
                        <div class="user-details">
                            <h4>${customer.name}</h4>
                            <p>${customer.phone || 'No phone'} ‚Ä¢ ${customer.plan} Plan/month</p>
                            ${customer.addons && customer.addons.length > 0 ? `<p style="color: rgba(255,255,255,0.6); font-size: 11px; margin-top: 2px;">Addons: ${customer.addons.join(', ')}</p>` : ''}
                            ${resellerAttribution}
                        </div>
                    </div>
                    <div>
                        <div class="user-status ${statusClass}">${statusText}</div>
                        <button class="action-btn" onclick="editUser('${customer.id}')">Edit</button>
                        <button class="action-btn" onclick="renewCustomerSubscription('${customer.id}')">Renew</button>
                        <button class="action-btn" onclick="changeUserPassword('${customer.id}')">Change Password</button>
                    </div>
                </div>
                `;
            }).join('');
        }

        function calculateCustomerStatus(customer) {
            if (!customer.endDate) {
                return { className: 'status-active', text: 'Active' };
            }
            
            const endDate = new Date(customer.endDate);
            const today = new Date();
            const timeDiff = endDate.getTime() - today.getTime();
            const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));
            
            if (daysDiff < 0) {
                return { className: 'status-expired', text: 'Expired' };
            } else if (daysDiff <= 3) {
                return { className: 'status-expiring', text: `Expiring (${daysDiff}d)` };
            } else {
                return { className: 'status-active', text: 'Active' };
            }
        }

        function initializeDateDropdowns() {
            const monthSelect = document.getElementById('endMonth');
            const dateSelect = document.getElementById('endDate');
            const yearSelect = document.getElementById('endYear');
            
            if (!monthSelect || !dateSelect || !yearSelect) return;
            
            // Clear existing options
            monthSelect.innerHTML = '<option value="">Month</option>';
            dateSelect.innerHTML = '<option value="">Date</option>';
            yearSelect.innerHTML = '<option value="">Year</option>';
            
            // Populate months
            const months = [
                'January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'
            ];
            months.forEach((month, index) => {
                const option = document.createElement('option');
                option.value = index + 1;
                option.textContent = `${(index + 1).toString().padStart(2, '0')} - ${month}`;
                monthSelect.appendChild(option);
            });
            
            // Populate dates (1-31)
            for (let i = 1; i <= 31; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i.toString().padStart(2, '0');
                dateSelect.appendChild(option);
            }
            
            // Populate years (current year + 5 years)
            const currentYear = new Date().getFullYear();
            for (let i = 0; i <= 5; i++) {
                const year = currentYear + i;
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearSelect.appendChild(option);
            }
            
            // Set default date (30 days from today)
            const defaultDate = new Date();
            defaultDate.setDate(defaultDate.getDate() + 30);
            
            monthSelect.value = defaultDate.getMonth() + 1;
            dateSelect.value = defaultDate.getDate();
            yearSelect.value = defaultDate.getFullYear();
        }

        function initializeEditDateDropdowns(customer) {
            const monthSelect = document.getElementById('editEndMonth');
            const dateSelect = document.getElementById('editEndDate');
            const yearSelect = document.getElementById('editEndYear');
            
            if (!monthSelect || !dateSelect || !yearSelect) return;
            
            // Clear existing options
            monthSelect.innerHTML = '<option value="">Month</option>';
            dateSelect.innerHTML = '<option value="">Date</option>';
            yearSelect.innerHTML = '<option value="">Year</option>';
            
            // Populate months
            const months = [
                'January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'
            ];
            months.forEach((month, index) => {
                const option = document.createElement('option');
                option.value = index + 1;
                option.textContent = `${(index + 1).toString().padStart(2, '0')} - ${month}`;
                monthSelect.appendChild(option);
            });
            
            // Populate dates (1-31)
            for (let i = 1; i <= 31; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i.toString().padStart(2, '0');
                dateSelect.appendChild(option);
            }
            
            // Populate years (current year + 5 years)
            const currentYear = new Date().getFullYear();
            for (let i = 0; i <= 5; i++) {
                const year = currentYear + i;
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearSelect.appendChild(option);
            }
            
            // Set customer's current end date or default to 30 days from today
            let customerDate;
            if (customer.endDate) {
                customerDate = new Date(customer.endDate);
            } else {
                customerDate = new Date();
                customerDate.setDate(customerDate.getDate() + 30);
            }
            
            monthSelect.value = customerDate.getMonth() + 1;
            dateSelect.value = customerDate.getDate();
            yearSelect.value = customerDate.getFullYear();
        }
        
        function generateResellerList() {
            const resellers = Object.keys(creditSystem.resellerCredits);
            if (resellers.length === 0) {
                return '<div style="text-align: center; padding: 40px; color: var(--text-secondary);">üè¢ No resellers found. Transfer credits to create reseller accounts.</div>';
            }
            
            return resellers.map(resellerId => {
                const balance = creditSystem.getResellerBalance(resellerId);
                
                // Get reseller customers from admin customers
                const adminCustomers = JSON.parse(localStorage.getItem('adminCustomers') || '[]');
                const resellerCustomers = adminCustomers.filter(c => c.resellerId === resellerId);
                const customerCount = resellerCustomers.length;
                const activeCustomers = resellerCustomers.filter(c => c.status === 'Active').length;
                
                return `
                    <div class="user-item" style="margin-bottom: 20px; border: 2px solid rgba(255,255,255,0.2);">
                        <div class="user-info">
                            <div class="user-avatar">R</div>
                            <div class="user-details">
                                <h4>${resellerId}</h4>
                                <p>Credit Balance: $${balance}</p>
                                <p style="color: #4caf50; font-weight: 600;">Customers: ${customerCount} (${activeCustomers} active)</p>
                            </div>
                        </div>
                        <div>
                            <div class="user-status status-active">Active</div>
                            <button class="action-btn" onclick="showResellerCustomers('${resellerId}')">üë• View Customers</button>
                            <button class="action-btn" onclick="editReseller('${resellerId}')">Edit</button>
                            <button class="action-btn" onclick="changeResellerPassword('${resellerId}')">Change Password</button>
                            <button class="action-btn-delete" onclick="deleteReseller('${resellerId}')">Delete</button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function getTotalResellerCredits() {
            return Object.values(creditSystem.resellerCredits).reduce((total, balance) => total + balance, 0);
        }

        function getTotalResellerCustomers() {
            const adminCustomers = JSON.parse(localStorage.getItem('adminCustomers') || '[]');
            const resellerCustomers = adminCustomers.filter(c => c.resellerId);
            return resellerCustomers.length;
        }

        function getTotalCustomers() {
            const adminCustomers = JSON.parse(localStorage.getItem('adminCustomers') || '[]');
            return adminCustomers.length;
        }

        function getActiveCustomers() {
            const adminCustomers = JSON.parse(localStorage.getItem('adminCustomers') || '[]');
            return adminCustomers.filter(c => c.status === 'Active').length;
        }

        function getExpiringCustomers() {
            const adminCustomers = JSON.parse(localStorage.getItem('adminCustomers') || '[]');
            const today = new Date();
            
            return adminCustomers.filter(customer => {
                if (!customer.endDate || customer.status !== 'Active') return false;
                
                const endDate = new Date(customer.endDate);
                const timeDiff = endDate.getTime() - today.getTime();
                const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));
                
                return daysDiff <= 3 && daysDiff >= 0;
            }).length;
        }

        function showResellerCustomers(resellerId) {
            const adminCustomers = JSON.parse(localStorage.getItem('adminCustomers') || '[]');
            const resellerCustomers = adminCustomers.filter(c => c.resellerId === resellerId);
            
            if (resellerCustomers.length === 0) {
                alert(`No customers found for ${resellerId}`);
                return;
            }
            
            let customerList = `Customers for ${resellerId}:\n\n`;
            resellerCustomers.forEach(customer => {
                customerList += `Name: ${customer.name}\n`;
                customerList += `Plan: ${customer.plan} ($${customer.balance}/month)\n`;
                customerList += `Status: ${customer.status}\n`;
                customerList += `Expires: ${customer.endDate}\n`;
                if (customer.phone) customerList += `Phone: ${customer.phone}\n`;
                customerList += `Password: ${customer.password}\n\n`;
            });
            
            alert(customerList);
        }

        function deleteReseller(resellerId) {
            const reseller = passwordManager.resellerCredentials[resellerId];
            if (!reseller) {
                showError('Reseller not found');
                return;
            }

            // Get assigned panel number
            const assignedPanel = localStorage.getItem(`reseller_${resellerId}_panel`);
            
            const confirmation = confirm(
                `‚ö†Ô∏è DELETE RESELLER CONFIRMATION\n\n` +
                `Are you sure you want to delete reseller:\n` +
                `‚Ä¢ ID: ${resellerId}\n` +
                `‚Ä¢ Username: ${reseller.username}\n` +
                `‚Ä¢ Panel: ${assignedPanel || 'None'}\n\n` +
                `This will:\n` +
                `‚Ä¢ Remove the reseller account\n` +
                `‚Ä¢ Free up panel #${assignedPanel || 'None'} for reuse\n` +
                `‚Ä¢ Delete all customer data\n` +
                `‚Ä¢ Cannot be undone!\n\n` +
                `Type "DELETE" to confirm:`
            );

            if (!confirmation) return;

            const deleteConfirm = prompt('Type "DELETE" to confirm:');
            if (deleteConfirm !== 'DELETE') {
                showError('Deletion cancelled - wrong confirmation text');
                return;
            }

            try {
                // Remove from password manager
                delete passwordManager.resellerCredentials[resellerId];
                passwordManager.saveCredentials();

                // Remove from credit system
                delete creditSystem.resellerCredits[resellerId];
                creditSystem.saveCredits();

                // Clear panel assignment
                if (assignedPanel) {
                    localStorage.removeItem(`reseller_${resellerId}_panel`);
                    localStorage.removeItem(`reseller_${assignedPanel}_assigned`);
                }

                // Clear customer data
                localStorage.removeItem(`resellerCustomers_${reseller.username}`);
                localStorage.removeItem(`resellerWallet_${reseller.username}`);

                console.log('üóëÔ∏è Reseller deleted:', resellerId);
                showSuccess(`Reseller ${resellerId} deleted successfully. Panel #${assignedPanel || 'None'} is now available for new reseller.`);
                
                // Refresh the reseller list
                showResellersSection();
                showCreditSection();
                
            } catch (error) {
                console.error('Error deleting reseller:', error);
                showError('Failed to delete reseller: ' + error.message);
            }
        }
        
        function generateSystemLogs() {
            const logs = [
                '[2025-11-13 09:22:51] INFO: Admin panel initialized',
                '[2025-11-13 09:22:51] INFO: Clean admin panel loaded - ready for production',
                '[2025-11-13 09:22:51] INFO: Credit system initialized - unlimited transfers enabled'
            ];
            
            return logs.join('<br>');
        }
        
        function editUser(customerId) {
            const customer = window.adminUsers.find(c => c.id === customerId);
            if (!customer) return;
            
            // Create edit customer modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 10001;
                display: flex;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(10px);
            `;
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #1a1a2e, #16213e); padding: 0; border-radius: 20px; border: 1px solid rgba(255,255,255,0.2); width: 500px; height: 600px; display: flex; flex-direction: column;">
                    <div style="padding: 20px 40px; border-bottom: 1px solid rgba(255,255,255,0.2);">
                        <h2 style="color: white; margin: 0; text-align: center;">‚úèÔ∏è Edit Customer</h2>
                    </div>
                    
                    <div style="flex: 1; padding: 20px 40px; overflow-y: auto;">
                        <form id="editCustomerForm" style="height: 100%;">
                            <div style="display: flex; flex-direction: column; height: 100%;">
                                <div style="flex: 1;">
                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Customer Name *</label>
                                        <input type="text" id="editCustomerName" required style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;" value="${customer.name}">
                                    </div>
                                    
                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Phone Number</label>
                                        <input type="tel" id="editCustomerPhone" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;" value="${customer.phone || ''}">
                                    </div>
                                    
                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Subscription Plan *</label>
                                        <select id="editCustomerPlan" required style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">
                                            ${generateEditPackageOptions(customer.plan)}
                                        </select>
                                    </div>
                                    
                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Status</label>
                                        <select id="editCustomerStatus" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">
                                            <option value="Active" ${customer.status === 'Active' ? 'selected' : ''}>Active</option>
                                            <option value="Expired" ${customer.status === 'Expired' ? 'selected' : ''}>Expired</option>
                                            <option value="Suspended" ${customer.status === 'Suspended' ? 'selected' : ''}>Suspended</option>
                                        </select>
                                    </div>
                                    
                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Subscription End Date *</label>
                                        <div style="display: flex; gap: 10px;">
                                            <select id="editEndMonth" required style="flex: 1; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">
                                                <option value="">Month</option>
                                            </select>
                                            <select id="editEndDate" required style="flex: 1; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">
                                                <option value="">Date</option>
                                            </select>
                                            <select id="editEndYear" required style="flex: 1; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">
                                                <option value="">Year</option>
                                            </select>
                                        </div>
                                        <div style="font-size: 12px; color: rgba(255,255,255,0.6); margin-top: 5px;">Select when the subscription expires</div>
                                    </div>
                                    
                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Addon Packages (Optional)</label>
                                        <div id="editAddonSelection" style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);">
                                            ${generateEditAddonOptions(customer.addons || [])}
                                        </div>
                                    </div>
                                    
                                    <div style="margin-bottom: 20px;">
                                        <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Current Devices (Locked)</label>
                                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);">
                                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                                <label style="color: rgba(255,255,255,0.6); display: flex; align-items: center; cursor: not-allowed;">
                                                    <input type="checkbox" name="editCustomerDevices" value="basicTV" checked disabled style="margin-right: 8px;">
                                                    Basic TV Package (+$25.00/month) - Required
                                                </label>
                                                <label style="color: ${customer.devices?.includes('secondTV') ? 'rgba(255,255,255,0.6)' : 'white'}; display: flex; align-items: center; cursor: ${customer.devices?.includes('secondTV') ? 'not-allowed' : 'pointer'};">
                                                    <input type="checkbox" name="editCustomerDevices" value="secondTV" ${customer.devices?.includes('secondTV') ? 'checked disabled' : ''} style="margin-right: 8px;">
                                                    2nd TV (+$${window.devicePricing?.secondTV || 0}/month) ${customer.devices?.includes('secondTV') ? '- Current (Locked)' : '(Available to Add)'}
                                                </label>
                                                <label style="color: ${customer.devices?.includes('thirdTV') ? 'rgba(255,255,255,0.6)' : 'white'}; display: flex; align-items: center; cursor: ${customer.devices?.includes('thirdTV') ? 'not-allowed' : 'pointer'};">
                                                    <input type="checkbox" name="editCustomerDevices" value="thirdTV" ${customer.devices?.includes('thirdTV') ? 'checked disabled' : ''} style="margin-right: 8px;">
                                                    3rd TV (+$${window.devicePricing?.thirdTV || 0}/month) ${customer.devices?.includes('thirdTV') ? '- Current (Locked)' : '(Available to Add)'}
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="display: flex; gap: 15px; margin-top: 20px;">
                                    <button type="button" onclick="closeEditCustomerModal()" style="flex: 1; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white; font-weight: 600; cursor: pointer;">Cancel</button>
                                    <button type="submit" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #4caf50, #66bb6a); border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer;">Update Customer</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.getElementById('editCustomerName').focus();
            
            // Initialize edit date dropdowns with customer's current end date
            initializeEditDateDropdowns(customer);
            
            // Handle form submission
            modal.querySelector('#editCustomerForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                customer.name = document.getElementById('editCustomerName').value;
                customer.phone = document.getElementById('editCustomerPhone').value;
                customer.plan = document.getElementById('editCustomerPlan').value;
                customer.status = document.getElementById('editCustomerStatus').value;
                
                // Get subscription end date from edit fields
                const editEndMonth = document.getElementById('editEndMonth').value;
                const editEndDate = document.getElementById('editEndDate').value;
                const editEndYear = document.getElementById('editEndYear').value;
                
                // Validate required fields
                if (!editEndMonth || !editEndDate || !editEndYear) {
                    showError('Please select subscription end date');
                    return;
                }
                
                // Update customer's end date
                const newEndDate = new Date(parseInt(editEndYear), parseInt(editEndMonth) - 1, parseInt(editEndDate));
                customer.endDate = newEndDate.toISOString().split('T')[0]; // YYYY-MM-DD format
                
                // Get selected addons
                const selectedAddons = Array.from(document.querySelectorAll('input[name="editCustomerAddons"]:checked'))
                    .map(checkbox => checkbox.value);
                customer.addons = selectedAddons;
                
                // Get selected devices
                const selectedDevices = Array.from(document.querySelectorAll('input[name="editCustomerDevices"]:checked'))
                    .map(checkbox => checkbox.value);
                customer.devices = selectedDevices;
                
                saveAdminCustomers(); // Save changes to localStorage
                
                closeEditCustomerModal();
                showUsersSection(); // Refresh the user list
                showSuccess(`Customer "${customer.name}" updated successfully!`);
            });
            
            // Handle click outside modal
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeEditCustomerModal();
                }
            });
        }
        
        function closeEditCustomerModal() {
            const modal = document.querySelector('div[style*="z-index: 10001"]');
            if (modal) {
                modal.remove();
            }
        }
        
        function changeUserPassword(customerId) {
            const adminCustomers = JSON.parse(localStorage.getItem('adminCustomers') || '[]');
            const customer = adminCustomers.find(c => c.id === customerId);
            if (!customer) return;
            
            const newPassword = prompt(`Change password for ${customer.name}\n\nReseller: ${customer.resellerId || 'Admin'}\n\nEnter new password:`);
            if (newPassword && newPassword.trim()) {
                customer.password = newPassword.trim();
                
                // Update in admin customers
                localStorage.setItem('adminCustomers', JSON.stringify(adminCustomers));
                
                // Update in reseller-specific storage if applicable
                if (customer.resellerId) {
                    const resellerCustomers = JSON.parse(localStorage.getItem(`${customer.resellerId}_customers`) || '[]');
                    const resellerCustomer = resellerCustomers.find(c => c.id === customerId);
                    if (resellerCustomer) {
                        resellerCustomer.password = newPassword.trim();
                        localStorage.setItem(`${customer.resellerId}_customers`, JSON.stringify(resellerCustomers));
                    }
                }
                
                showSuccess(`Password updated for "${customer.name}"`);
            }
        }

        function renewCustomerSubscription(customerId) {
            const adminCustomers = JSON.parse(localStorage.getItem('adminCustomers') || '[]');
            const customer = adminCustomers.find(c => c.id === customerId);
            if (!customer) {
                showError('Customer not found');
                return;
            }

            // Ask for renewal period
            const resellerInfo = customer.resellerId ? ` (Reseller: ${customer.resellerId})` : '';
            const months = prompt(`Renew subscription for ${customer.name}${resellerInfo}\n\nEnter number of months to extend (default: 1 month):`, '1');
            if (months === null) return; // User cancelled
            
            const extendMonths = parseInt(months);
            if (isNaN(extendMonths) || extendMonths <= 0 || extendMonths > 24) {
                showError('Please enter a valid number of months (1-24)');
                return;
            }

            // Get current end date or default to today if no end date
            let currentEndDate = customer.endDate ? new Date(customer.endDate) : new Date();
            const today = new Date();
            
            // If no end date or end date is in the past, start from today
            if (!customer.endDate || currentEndDate < today) {
                currentEndDate = today;
            }

            // Add months to current end date
            const newEndDate = new Date(currentEndDate);
            newEndDate.setMonth(newEndDate.getMonth() + extendMonths);
            
            // Update customer record
            customer.endDate = newEndDate.toISOString().split('T')[0]; // YYYY-MM-DD format
            customer.status = 'Active'; // Set status to Active when renewed
            
            // Save to admin customers
            localStorage.setItem('adminCustomers', JSON.stringify(adminCustomers));
            
            // Save to reseller-specific storage if applicable
            if (customer.resellerId) {
                const resellerCustomers = JSON.parse(localStorage.getItem(`${customer.resellerId}_customers`) || '[]');
                const resellerCustomer = resellerCustomers.find(c => c.id === customerId);
                if (resellerCustomer) {
                    resellerCustomer.endDate = customer.endDate;
                    resellerCustomer.status = customer.status;
                    localStorage.setItem(`${customer.resellerId}_customers`, JSON.stringify(resellerCustomers));
                }
            }
            
            showUsersSection(); // Refresh the user list
            showSuccess(`Subscription renewed for "${customer.name}" - Extended ${extendMonths} month(s) until ${newEndDate.toLocaleDateString()}`);
        }

        function changeResellerPassword(resellerId) {
            const reseller = passwordManager.resellerCredentials[resellerId];
            if (!reseller) return;
            
            const newPassword = prompt(`Change password for reseller "${resellerId}"\n\nEnter new password (min 6 characters):`);
            if (!newPassword) return;
            
            if (newPassword.length < 6) {
                showError('Password must be at least 6 characters');
                return;
            }
            
            const confirmPassword = prompt('Confirm new password:');
            if (newPassword !== confirmPassword) {
                showError('Passwords do not match');
                return;
            }
            
            reseller.password = newPassword;
            passwordManager.saveCredentials();
            showSuccess(`Password updated for reseller "${resellerId}"`);
            showResellersSection(); // Refresh the reseller list
        }
        
        function editReseller(resellerId) {
            console.log('Opening edit modal for reseller:', resellerId);
            
            // Get current reseller data
            const resellerData = passwordManager.resellerCredentials[resellerId] || {};
            const currentBalance = creditSystem.getResellerBalance(resellerId);
            
            // Create edit modal
            const modal = document.createElement('div');
            modal.id = 'editResellerModal';
            modal.className = 'modal active';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 10px; width: 90%; max-width: 500px; max-height: 80%; overflow-y: auto;">
                    <h2>Edit Reseller: ${resellerId}</h2>
                    
                    <form id="editResellerForm">
                        <div style="margin-bottom: 15px;">
                            <label>Username:</label>
                            <input type="text" id="editUsername" value="${resellerData.username || ''}" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label>Panel Assignment:</label>
                            <select id="editPanelAssignment" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">Select Panel</option>
                                ${Array.from({length: 12}, (_, i) => `<option value="${String(i + 1).padStart(3, '0')}" ${getResellerPanelAssignment(resellerId) === String(i + 1).padStart(3, '0') ? 'selected' : ''}>Panel #${String(i + 1).padStart(3, '0')}</option>`).join('')}
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label>Status:</label>
                            <select id="editStatus" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="suspended">Suspended</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label>Commission Rate (%):</label>
                            <input type="number" id="editCommission" value="15" min="0" max="100" step="0.1" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label>Current Balance:</label>
                            <input type="text" value="$${currentBalance.toFixed(2)}" readonly style="width: 100%; padding: 8px; background: #f8f9fa; border: 1px solid #ccc; border-radius: 4px;">
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label>Notes:</label>
                            <textarea id="editNotes" placeholder="Internal notes about this reseller..." style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; height: 80px;"></textarea>
                        </div>
                        
                        <div style="text-align: right;">
                            <button type="button" onclick="closeEditResellerModal()" style="padding: 10px 20px; margin-right: 10px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer;">Cancel</button>
                            <button type="submit" style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">Save Changes</button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Handle form submission
            const editForm = document.getElementById('editResellerForm');
            if (editForm) {
                editForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    console.log('üìù Edit form submitted for:', resellerId);
                    
                    const updatedData = {
                        username: document.getElementById('editUsername').value,
                        panelAssignment: document.getElementById('editPanelAssignment').value,
                        status: document.getElementById('editStatus').value,
                        commission: parseFloat(document.getElementById('editCommission').value),
                        notes: document.getElementById('editNotes').value
                    };
                    
                    console.log('üìù Updated data:', updatedData);
                    
                    // Update reseller data
                    updateResellerData(resellerId, updatedData);
                    
                    closeEditResellerModal();
                    showResellersSection(); // Refresh the list
                });
                
                console.log('‚úÖ Edit form event listener attached');
            } else {
                console.error('‚ùå Edit form not found!');
            }
        }

        function closeEditResellerModal() {
            const modal = document.getElementById('editResellerModal');
            if (modal) {
                modal.remove();
            }
        }

        function updateResellerData(resellerId, data) {
            // Update in password manager
            if (passwordManager.resellerCredentials[resellerId]) {
                Object.assign(passwordManager.resellerCredentials[resellerId], {
                    username: data.username,
                    status: data.status,
                    commission: data.commission,
                    notes: data.notes
                });
                passwordManager.saveCredentials();
            }
            
            // Update panel assignment
            if (data.panelAssignment) {
                localStorage.setItem(`reseller_${resellerId}_panel`, data.panelAssignment);
            }
            
            console.log('Updated reseller data for:', resellerId, data);
            showSuccess(`Reseller ${resellerId} updated successfully`);
        }

        function getResellerPanelAssignment(resellerId) {
            return localStorage.getItem(`reseller_${resellerId}_panel`) || '';
        }
        
        // Device and Addon Price Calculation
        function updatePriceCalculation() {
            const priceDisplay = document.getElementById('priceDisplay');
            if (!priceDisplay) return;
            
            // Get selected devices
            const selectedDevices = Array.from(document.querySelectorAll('input[name="customerDevices"]:checked'))
                .map(cb => cb.value);
            
            // Get selected addons
            const selectedAddons = Array.from(document.querySelectorAll('input[name="customerAddons"]:checked'))
                .map(cb => cb.value);
            
            // Calculate total price
            let totalPrice = 0;
            
            // Use dynamic device pricing
            selectedDevices.forEach(device => {
                if (device === 'basicTV') {
                    totalPrice += 25.00; // Basic TV price is fixed
                } else if (device === 'secondTV') {
                    totalPrice += (window.devicePricing?.secondTV || 15.00); // Use dynamic pricing
                } else if (device === 'thirdTV') {
                    totalPrice += (window.devicePricing?.thirdTV || 12.00); // Use dynamic pricing
                }
            });
            
            // Calculate addon prices
            selectedAddons.forEach(addonName => {
                const addon = window.addons.find(a => a.name === addonName);
                if (addon) {
                    totalPrice += addon.price;
                }
            });
            
            if (selectedDevices.length === 0 && selectedAddons.length === 0) {
                priceDisplay.style.display = 'none';
                return;
            }
            
            // Update price display
            priceDisplay.style.display = 'block';
            document.getElementById('totalPrice').textContent = `Total Monthly: $${totalPrice.toFixed(2)}`;
            
            // Show breakdown
            const breakdownParts = [];
            
            // Add devices to breakdown
            selectedDevices.forEach(device => {
                const deviceName = device === 'basicTV' ? 'Basic TV' : 
                                 device === 'secondTV' ? '2nd TV' : '3rd TV';
                
                let devicePrice = 0;
                if (device === 'basicTV') {
                    devicePrice = 25.00;
                } else if (device === 'secondTV') {
                    devicePrice = window.devicePricing?.secondTV || 15.00;
                } else if (device === 'thirdTV') {
                    devicePrice = window.devicePricing?.thirdTV || 12.00;
                }
                
                breakdownParts.push(`${deviceName}: $${devicePrice.toFixed(2)}/month`);
            });
            
            // Add addons to breakdown
            selectedAddons.forEach(addonName => {
                const addon = window.addons.find(a => a.name === addonName);
                if (addon) {
                    breakdownParts.push(`${addon.name}: +$${addon.price}/month`);
                }
            });
            
            document.getElementById('priceBreakdown').textContent = breakdownParts.join(' + ');
        }

        // Device Selection Business Rules - Basic ‚Üí 2nd TV ‚Üí 3rd TV
        function updateDeviceSelection() {
            const basicCheckbox = document.getElementById('basicTVCheckbox');
            const secondTVCheckbox = document.getElementById('secondTVCheckbox');
            const thirdTVCheckbox = document.getElementById('thirdTVCheckbox');
            
            if (!basicCheckbox || !secondTVCheckbox || !thirdTVCheckbox) {
                return; // Function called before DOM elements are ready
            }
            
            // Basic package rules
            if (basicCheckbox.checked) {
                // Enable 2nd TV when Basic is selected
                secondTVCheckbox.disabled = false;
                secondTVCheckbox.parentElement.style.opacity = '1';
            } else {
                // Disable and uncheck 2nd TV when Basic is deselected
                secondTVCheckbox.disabled = true;
                secondTVCheckbox.checked = false;
                secondTVCheckbox.parentElement.style.opacity = '0.5';
            }
            
            // 2nd TV rules
            if (secondTVCheckbox.checked) {
                // Enable 3rd TV when 2nd TV is selected
                thirdTVCheckbox.disabled = false;
                thirdTVCheckbox.parentElement.style.opacity = '1';
            } else {
                // Disable and uncheck 3rd TV when 2nd TV is deselected
                thirdTVCheckbox.disabled = true;
                thirdTVCheckbox.checked = false;
                thirdTVCheckbox.parentElement.style.opacity = '0.5';
            }
            
            // Update visual feedback
            if (basicCheckbox.checked) {
                basicCheckbox.parentElement.style.background = 'rgba(76, 175, 80, 0.2)';
                basicCheckbox.parentElement.style.border = '1px solid #4caf50';
            } else {
                basicCheckbox.parentElement.style.background = 'transparent';
                basicCheckbox.parentElement.style.border = '1px solid rgba(255,255,255,0.2)';
            }
            
            if (secondTVCheckbox.checked && !secondTVCheckbox.disabled) {
                secondTVCheckbox.parentElement.style.background = 'rgba(76, 175, 80, 0.2)';
                secondTVCheckbox.parentElement.style.border = '1px solid #4caf50';
            } else {
                secondTVCheckbox.parentElement.style.background = 'transparent';
                secondTVCheckbox.parentElement.style.border = '1px solid rgba(255,255,255,0.2)';
            }
            
            if (thirdTVCheckbox.checked && !thirdTVCheckbox.disabled) {
                thirdTVCheckbox.parentElement.style.background = 'rgba(76, 175, 80, 0.2)';
                thirdTVCheckbox.parentElement.style.border = '1px solid #4caf50';
            } else {
                thirdTVCheckbox.parentElement.style.background = 'transparent';
                thirdTVCheckbox.parentElement.style.border = '1px solid rgba(255,255,255,0.2)';
            }
        }

        // Customer Management
        function addNewCustomer() {
            // Create customer form modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 10001;
                display: flex;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(10px);
            `;
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #1a1a2e, #16213e); padding: 40px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.2); width: 500px; max-height: 80vh; overflow-y: auto;">
                    <h2 style="color: white; margin-bottom: 20px; text-align: center;">‚ûï Add New Customer</h2>
                    
                    <form id="customerForm">
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Customer Name *</label>
                            <input type="text" id="customerName" required style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;" placeholder="Enter full name">
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Phone Number</label>
                            <input type="tel" id="customerPhone" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;" placeholder="+1234567890">
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Subscription Plan *</label>
                            <select id="customerPlan" required style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">
                                <option value="">Select a plan</option>
                                ${generatePackageOptions()}
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Additional Devices (Optional)</label>
                            <div style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; padding: 15px;">
                                <div style="display: flex; flex-direction: column; gap: 10px;">
                                    <label style="color: white; display: flex; align-items: center; cursor: pointer;">
                                        <input type="checkbox" name="customerDevices" value="basicTV" id="basicTVCheckbox" style="margin-right: 8px;" onchange="updateDeviceSelection(); updatePriceCalculation()">
                                        Basic TV Package (+$25.00/month) - REQUIRED FIRST
                                    </label>
                                    <label style="color: white; display: flex; align-items: center; cursor: pointer;">
                                        <input type="checkbox" name="customerDevices" value="secondTV" id="secondTVCheckbox" style="margin-right: 8px;" onchange="updateDeviceSelection(); updatePriceCalculation()" disabled>
                                        2nd TV (+$${window.devicePricing?.secondTV || 15.00}/month) - Available after Basic
                                    </label>
                                    <label style="color: white; display: flex; align-items: center; cursor: pointer;">
                                        <input type="checkbox" name="customerDevices" value="thirdTV" id="thirdTVCheckbox" style="margin-right: 8px;" onchange="updateDeviceSelection(); updatePriceCalculation()" disabled>
                                        3rd TV (+$${window.devicePricing?.thirdTV || 12.00}/month) - Available after 2nd TV
                                    </label>
                                </div>
                                <div style="font-size: 12px; color: rgba(255,255,255,0.6); margin-top: 5px;">Basic package must be selected first, then 2nd TV, then 3rd TV</div>
                                
                                <!-- Price Calculation Display -->
                                <div id="priceDisplay" style="margin-top: 15px; padding: 15px; background: rgba(76, 175, 80, 0.1); border: 1px solid #4caf50; border-radius: 8px; display: none;">
                                    <h4 style="color: #4caf50; margin: 0 0 10px 0;">üí∞ Subscription Cost</h4>
                                    <div style="color: white; font-size: 16px; font-weight: 600;" id="totalPrice">Total Monthly: $0.00</div>
                                    <div style="color: rgba(255,255,255,0.7); font-size: 12px;" id="priceBreakdown"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Addons (Optional)</label>
                            <div id="addonSelection" style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; padding: 15px; max-height: 120px; overflow-y: auto;">
                                ${generateAddonOptions()}
                            </div>
                            <div style="font-size: 12px; color: rgba(255,255,255,0.6); margin-top: 5px;">Select any additional packages you want to include</div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Subscription End Date *</label>
                            <div style="display: flex; gap: 10px;">
                                <select id="endMonth" required style="flex: 1; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">
                                    <option value="">Month</option>
                                </select>
                                <select id="endDate" required style="flex: 1; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">
                                    <option value="">Date</option>
                                </select>
                                <select id="endYear" required style="flex: 1; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">
                                    <option value="">Year</option>
                                </select>
                            </div>
                            <div style="font-size: 12px; color: rgba(255,255,255,0.6); margin-top: 5px;">Select when the subscription expires</div>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; color: white; font-weight: 500;">Password *</label>
                            <input type="password" id="customerPassword" required style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;" placeholder="Auto-generated password" value="customer123">
                        </div>
                        
                        <div style="display: flex; gap: 15px;">
                            <button type="submit" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #4caf50, #66bb6a); border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer;">Add Customer</button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.getElementById('customerName').focus();
            
            // Initialize date dropdowns with default values (30 days from today)
            initializeDateDropdowns();
            
            // Initialize device selection business rules
            updateDeviceSelection();
            
            // Handle form submission
            modal.querySelector('#customerForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const name = document.getElementById('customerName').value;
                const phone = document.getElementById('customerPhone').value;
                const plan = document.getElementById('customerPlan').value;
                const password = document.getElementById('customerPassword').value;
                
                // Get subscription end date
                const endMonth = document.getElementById('endMonth').value;
                const endDate = document.getElementById('endDate').value;
                const endYear = document.getElementById('endYear').value;
                
                // Get selected addons
                const selectedAddons = Array.from(document.querySelectorAll('input[name="customerAddons"]:checked'))
                    .map(checkbox => checkbox.value);
                
                // Get selected devices
                const selectedDevices = Array.from(document.querySelectorAll('input[name="customerDevices"]:checked'))
                    .map(checkbox => checkbox.value);
                
                // Validate business rules
                if (selectedDevices.includes('secondTV') && !selectedDevices.includes('basicTV')) {
                    showError('2nd TV can only be added after Basic TV Package is selected');
                    return;
                }
                if (selectedDevices.includes('thirdTV') && !selectedDevices.includes('secondTV')) {
                    showError('3rd TV can only be added after 2nd TV is selected');
                    return;
                }
                
                if (!name || !plan || !password || !endMonth || !endDate || !endYear) {
                    showError('Please fill in all required fields');
                    return;
                }
                
                // Create subscription end date from selected values
                const subscriptionEndDate = new Date(parseInt(endYear), parseInt(endMonth) - 1, parseInt(endDate));
                const formattedEndDate = subscriptionEndDate.toISOString().split('T')[0]; // YYYY-MM-DD format
                
                const newCustomer = {
                    id: 'customer_' + Date.now(),
                    name: name,
                    phone: phone,
                    plan: plan,
                    addons: selectedAddons,
                    devices: selectedDevices,
                    password: password,
                    status: 'Active',
                    avatar: name.charAt(0).toUpperCase(),
                    createdAt: new Date().toLocaleDateString(),
                    endDate: formattedEndDate, // YYYY-MM-DD format from user selection
                    resellerId: 'admin', // Admin-created customers are attributed to admin
                    resellerName: 'Admin Panel'
                };
                
                window.adminUsers.push(newCustomer);
                saveAdminCustomers();
                
                closeCustomerModal();
                showUsersSection(); // Refresh the user list to show new customer
                initializePackages(); // Refresh package list for forms
                
                let message = `New customer "${name}" added successfully!\nPlan: ${plan}/month\nPassword: ${password}`;
                if (phone) {
                    message += `\nPhone: ${phone}`;
                }
                if (selectedAddons.length > 0) {
                    message += `\nAddons: ${selectedAddons.join(', ')} (+$${selectedAddons.reduce((total, addonName) => {
                        const addon = window.addons.find(a => a.name === addonName);
                        return total + (addon ? addon.price : 0);
                    }, 0)}/month)`;
                }
                
                showSuccess(message);
            });
            
            // Handle click outside modal
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeCustomerModal();
                }
            });
        }
        
        function closeCustomerModal() {
            const modal = document.querySelector('div[style*="z-index: 10001"]');
            if (modal) {
                modal.remove();
            }
        }
        
        // Package Management Functions
        function initializePackages() {
            // Clear old cached package data to prevent conflicts
            localStorage.removeItem('adminPackages');
            localStorage.removeItem('adminPackagesForReseller');
            localStorage.removeItem('packagesUpdated');
            
            // Initialize with only Basic TV Package
            window.packages = [
                {
                    id: 'basic_tv',
                    name: 'Basic TV Package',
                    description: 'Core TV channels and basic entertainment - REQUIRED FIRST',
                    price: 25.00,
                    required: true,
                    status: 'active',
                    type: 'basic',
                    features: ['100+ channels', 'HD quality', 'Basic sports', 'Local news']
                }
            ];
            console.log('üì¶ ADMIN: Packages initialized with only Basic TV Package');
            
            // Immediately save the initial state for reseller sync
            savePackages();
            console.log('üì¶ ADMIN: Packages initialized and saved');
        }
        
        function savePackages() {
            try {
                smartStorage.setItem('adminPackages', window.packages);
                // Save packages in the format reseller expects: { name: {...} }
                const resellerPackages = {};
                window.packages.forEach(pkg => {
                    resellerPackages[pkg.name] = {
                        name: pkg.name,
                        price: pkg.price,
                        channels: pkg.features ? pkg.features.length + '+' : '100+',
                        description: pkg.description
                    };
                });
                smartStorage.setItem('iptvPackages', resellerPackages);
                
                // Trigger real-time synchronization for reseller panels
                localStorage.setItem('packagesUpdated', Date.now().toString());
                localStorage.setItem('syncNotification', JSON.stringify({
                    type: 'packages_updated',
                    timestamp: Date.now(),
                    packages: window.packages.length
                }));
                
                console.log('üì¶ ADMIN: Packages saved with cloud sync to reseller panels');
                
                // Show success feedback
                showSuccess(`Packages saved and synchronized (${window.packages.length} packages)`);
                
            } catch (e) {
                console.error('Error saving packages:', e);
                showError('Failed to save packages');
            }
        }
        
        // Debug Function to Force Save All Packages
        function debugSaveAllPackages() {
            console.log('üîç DEBUG: Force saving all packages...');
            console.log('Current packages count:', window.packages ? window.packages.length : 0);
            
            if (window.packages && window.packages.length > 0) {
                console.log('üì¶ DEBUG: Packages to save:', window.packages.map(p => `${p.name}(${p.type})`));
                savePackages();
                
                // Also show what's in localStorage
                const saved = localStorage.getItem('adminPackages');
                if (saved) {
                    try {
                        const parsed = JSON.parse(saved);
                        console.log('‚úÖ DEBUG: localStorage contains', parsed.length, 'packages');
                        console.log('DEBUG: Package types:', parsed.map(p => `${p.type}:${p.name}`));
                        showSuccess(`üîç DEBUG: Force saved ${parsed.length} packages (check console)`);
                    } catch (e) {
                        console.error('‚ùå DEBUG: Error parsing saved packages:', e);
                        showError('‚ùå DEBUG: Error with saved packages');
                    }
                }
            } else {
                console.log('‚ö†Ô∏è DEBUG: No packages to save, re-initializing...');
                initializePackages();
                savePackages();
                showSuccess('üîç DEBUG: Re-initialized and saved packages');
            }
        }
        
        function generatePackageList() {
            if (!window.packages || window.packages.length === 0) {
                return '<div style="text-align: center; padding: 20px; color: var(--text-secondary); font-size: 12px;">üì¶ No packages found. Click "Add Package" to get started.</div>';
            }
            
            return window.packages.map(pkg => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <div>
                        <h4 style="color: white; margin: 0 0 5px 0; font-size: 14px;">${pkg.name}</h4>
                        <p style="color: rgba(255,255,255,0.7); margin: 0; font-size: 12px;">$${pkg.price}/month</p>
                    </div>
                    <div>
                        <button onclick="editPackage('${pkg.id}')" style="background: var(--admin-color); color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 10px; margin-right: 5px;">Edit</button>
                        <button onclick="deletePackage('${pkg.id}')" style="background: #f44336; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 10px;">Delete</button>
                    </div>
                </div>
            `).join('');
        }
        
        function generatePackageOptions() {
            // Only show Basic TV Package in dropdown
            return '<option value="Basic TV Package">Basic TV Package</option>';
        }
        
        function generateEditPackageOptions(currentPlan) {
            // For editing customer, show their current package as locked and only Basic TV Package as editable option
            const currentDisabled = `<option value="${currentPlan}" disabled selected>${currentPlan} (Current - Locked)</option>`;
            const basicOption = currentPlan !== 'Basic TV Package' ? '<option value="Basic TV Package">Basic TV Package (Add New)</option>' : '';
            
            return currentDisabled + basicOption;
        }
        
        function generateAddonOptions() {
            if (!window.addons || window.addons.length === 0) {
                return '<div style="color: rgba(255,255,255,0.5); font-size: 12px; text-align: center;">No addons available</div>';
            }
            
            return window.addons.map(addon => `
                <label style="display: flex; align-items: center; margin-bottom: 8px; cursor: pointer;">
                    <input type="checkbox" name="customerAddons" value="${addon.name}" onchange="updatePriceCalculation()" style="margin-right: 8px;">
                    <span style="color: white; font-size: 14px;">${addon.name}</span>
                    <span style="margin-left: auto; color: rgba(255,255,255,0.7); font-size: 12px;">+$${addon.price}/month</span>
                </label>
            `).join('');
        }
        
        function generateEditAddonOptions(selectedAddons = []) {
            if (!window.addons || window.addons.length === 0) {
                return '<div style="color: rgba(255,255,255,0.5); font-size: 12px; text-align: center;">No addons available</div>';
            }
            
            return window.addons.map(addon => {
                // More robust matching - handle case-insensitive and trim spaces
                const isCurrentAddon = selectedAddons.some(selected => 
                    selected.trim().toLowerCase() === addon.name.trim().toLowerCase()
                );
                
                return `
                    <label style="display: flex; align-items: center; margin-bottom: 8px; cursor: ${isCurrentAddon ? 'not-allowed' : 'pointer'};">
                        <input type="checkbox" name="editCustomerAddons" value="${addon.name}" ${isCurrentAddon ? 'checked disabled' : ''} onchange="updatePriceCalculation()" style="margin-right: 8px;">
                        <span style="color: ${isCurrentAddon ? 'rgba(255,255,255,0.6)' : 'white'}; font-size: 14px;">${addon.name} ${isCurrentAddon ? '(Current - Locked)' : '(Available to Add)'}</span>
                        <span style="margin-left: auto; color: ${isCurrentAddon ? 'rgba(255,255,255,0.6)' : 'rgba(255,255,255,0.7)'}; font-size: 12px;">+$${addon.price}/month</span>
                    </label>
                `;
            }).join('');
        }
        
        // Addon Management Functions
        function initializeAddons() {
            const saved = localStorage.getItem('adminAddons');
            if (saved) {
                try {
                    window.addons = JSON.parse(saved);
                } catch (e) {
                    console.error('Error loading addons:', e);
                    window.addons = [];
                }
            } else {
                window.addons = [];
            }
        }
        
        function saveAddons() {
            try {
                // Save for admin panel
                localStorage.setItem('adminAddons', JSON.stringify(window.addons));
                // Save for reseller panel in expected format
                localStorage.setItem('iptvAddons', JSON.stringify(window.addons));
            } catch (e) {
                console.error('Error saving addons:', e);
            }
        }
        
        function generateAddonList() {
            if (!window.addons || window.addons.length === 0) {
                return '<div style="text-align: center; padding: 20px; color: var(--text-secondary); font-size: 12px;">üîß No addons found. Click "Add Addon" to get started.</div>';
            }
            
            return window.addons.map(addon => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <div>
                        <h4 style="color: white; margin: 0 0 5px 0; font-size: 14px;">${addon.name}</h4>
                        <p style="color: rgba(255,255,255,0.7); margin: 0; font-size: 12px;">$${addon.price}/month</p>
                    </div>
                    <div>
                        <button onclick="editAddon('${addon.id}')" style="background: #ff9800; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 10px; margin-right: 5px;">Edit</button>
                        <button onclick="deleteAddon('${addon.id}')" style="background: #f44336; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 10px;">Delete</button>
                    </div>
                </div>
            `).join('');
        }
        
        // Add Package Function
        function addNewPackage() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 10001;
                display: flex;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(10px);
            `;
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #1a1a2e, #16213e); padding: 30px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.2); width: 400px;">
                    <h3 style="color: white; margin-bottom: 20px; text-align: center;">üì¶ Add New Package</h3>
                    
                    <form id="packageForm">
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: white; font-size: 14px;">Package Name *</label>
                            <input type="text" id="packageName" required style="width: 100%; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: white; font-size: 14px;" placeholder="e.g., Starter Plan">
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 5px; color: white; font-size: 14px;">Monthly Price ($) *</label>
                            <input type="number" id="packagePrice" required style="width: 100%; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: white; font-size: 14px;" placeholder="0.00" min="0" step="0.01">
                        </div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button type="button" onclick="closePackageModal()" style="flex: 1; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: white; font-weight: 500; cursor: pointer; font-size: 14px;">Cancel</button>
                            <button type="submit" style="flex: 1; padding: 10px; background: var(--admin-color); border: none; border-radius: 6px; color: white; font-weight: 600; cursor: pointer; font-size: 14px;">Add Package</button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.getElementById('packageName').focus();
            
            modal.querySelector('#packageForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const name = document.getElementById('packageName').value;
                const price = parseFloat(document.getElementById('packagePrice').value);
                
                if (!name || price <= 0) {
                    showError('Please fill in all required fields');
                    return;
                }
                
                // Determine package type based on price or add as generic addon
                let packageType = 'addon';
                let requiresBasic = true; // Most add-ons require basic TV
                let features = ['Custom package', 'Added by admin'];
                
                // Auto-categorize based on price ranges
                if (price <= 15) {
                    packageType = 'addon';
                } else if (price <= 25) {
                    packageType = 'addon'; 
                } else {
                    packageType = 'addon';
                }
                
                const newPackage = {
                    id: 'pkg_' + Date.now(),
                    name: name,
                    description: `Custom ${name} package - BASIC REQUIRED`,
                    price: price,
                    required: false,
                    status: 'active',
                    type: packageType,
                    features: features,
                    requiresBasic: requiresBasic,
                    createdAt: new Date().toLocaleDateString()
                };
                
                window.packages.push(newPackage);
                savePackages();
                
                closePackageModal();
                showPackagesSection();
                showSuccess(`Package "${name}" added successfully!`);
            });
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closePackageModal();
                }
            });
        }
        
        function closePackageModal() {
            const modal = document.querySelector('div[style*="z-index: 10001"]');
            if (modal) {
                modal.remove();
            }
        }
        
        // Add Addon Function
        function addNewAddon() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 10001;
                display: flex;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(10px);
            `;
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #1a1a2e, #16213e); padding: 30px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.2); width: 400px;">
                    <h3 style="color: white; margin-bottom: 20px; text-align: center;">üîß Add New Addon</h3>
                    
                    <form id="addonForm">
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: white; font-size: 14px;">Addon Name *</label>
                            <input type="text" id="addonName" required style="width: 100%; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: white; font-size: 14px;" placeholder="e.g., Sports Package">
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 5px; color: white; font-size: 14px;">Monthly Price ($) *</label>
                            <input type="number" id="addonPrice" required style="width: 100%; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: white; font-size: 14px;" placeholder="0.00" min="0" step="0.01">
                        </div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button type="button" onclick="closeAddonModal()" style="flex: 1; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: white; font-weight: 500; cursor: pointer; font-size: 14px;">Cancel</button>
                            <button type="submit" style="flex: 1; padding: 10px; background: #ff9800; border: none; border-radius: 6px; color: white; font-weight: 600; cursor: pointer; font-size: 14px;">Add Addon</button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.getElementById('addonName').focus();
            
            modal.querySelector('#addonForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const name = document.getElementById('addonName').value;
                const price = parseFloat(document.getElementById('addonPrice').value);
                
                if (!name || price <= 0) {
                    showError('Please fill in all required fields');
                    return;
                }
                
                const newAddon = {
                    id: 'addon_' + Date.now(),
                    name: name,
                    price: price,
                    type: 'addon',
                    createdAt: new Date().toLocaleDateString()
                };
                
                window.addons.push(newAddon);
                saveAddons();
                
                closeAddonModal();
                showPackagesSection();
                showSuccess(`Addon "${name}" added successfully!`);
            });
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeAddonModal();
                }
            });
        }
        
        function closeAddonModal() {
            const modal = document.querySelector('div[style*="z-index: 10001"]');
            if (modal) {
                modal.remove();
            }
        }
        
        // Device Pricing Functions
        function initializeDevicePricing() {
            const saved = localStorage.getItem('devicePricing');
            if (saved) {
                try {
                    window.devicePricing = JSON.parse(saved);
                    // Ensure basicTV is always present
                    if (window.devicePricing.basicTV === undefined) {
                        window.devicePricing.basicTV = 25.00;
                        saveDevicePricing();
                    }
                } catch (e) {
                    console.error('Error loading device pricing:', e);
                    window.devicePricing = {
                        basicTV: 25.00,
                        secondTV: 0,
                        thirdTV: 0
                    };
                }
            } else {
                window.devicePricing = {
                    basicTV: 25.00,
                    secondTV: 0,
                    thirdTV: 0
                };
            }
        }
        
        function saveDevicePricing() {
            try {
                // Ensure basicTV is included in device pricing
                const pricingWithBasic = {
                    basicTV: 25.00, // Fixed price for Basic TV
                    ...window.devicePricing
                };
                localStorage.setItem('devicePricing', JSON.stringify(pricingWithBasic));
            } catch (e) {
                console.error('Error saving device pricing:', e);
            }
        }
        
        function editDevicePrice(deviceType) {
            const labels = {
                secondTV: '2nd TV', 
                thirdTV: '3rd TV'
            };
            
            if (!labels[deviceType]) {
                showError('Invalid device type');
                return;
            }
            
            const currentPrice = window.devicePricing[deviceType] || 0;
            const newPrice = prompt(`Set price for ${labels[deviceType]}:\n\nCurrent: $${currentPrice}/month\n\nEnter new price:`, currentPrice);
            
            if (newPrice !== null) {
                const price = parseFloat(newPrice);
                if (!isNaN(price) && price >= 0) {
                    window.devicePricing[deviceType] = price;
                    saveDevicePricing();
                    showPackagesSection();
                    showSuccess(`${labels[deviceType]} price updated to $${price}/month`);
                } else {
                    showError('Please enter a valid price');
                }
            }
        }
        
        function deletePackage(packageId) {
            const pkg = window.packages.find(p => p.id === packageId);
            if (!pkg) return;
            
            if (confirm(`Are you sure you want to delete package "${pkg.name}"?`)) {
                window.packages = window.packages.filter(p => p.id !== packageId);
                savePackages();
                showPackagesSection();
                showSuccess(`Package "${pkg.name}" deleted`);
            }
        }
        
        function deleteAddon(addonId) {
            const addon = window.addons.find(a => a.id === addonId);
            if (!addon) return;
            
            if (confirm(`Are you sure you want to delete addon "${addon.name}"?`)) {
                window.addons = window.addons.filter(a => a.id !== addonId);
                saveAddons();
                showPackagesSection();
                showSuccess(`Addon "${addon.name}" deleted`);
            }
        }
        
        function editPackage(packageId) {
            const pkg = window.packages.find(p => p.id === packageId);
            if (!pkg) return;
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 10001;
                display: flex;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(10px);
            `;
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #1a1a2e, #16213e); padding: 30px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.2); width: 400px;">
                    <h3 style="color: white; margin-bottom: 20px; text-align: center;">‚úèÔ∏è Edit Package</h3>
                    
                    <form id="editPackageForm">
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: white; font-size: 14px;">Package Name *</label>
                            <input type="text" id="editPackageName" required style="width: 100%; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: white; font-size: 14px;" value="${pkg.name}">
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 5px; color: white; font-size: 14px;">Monthly Price ($) *</label>
                            <input type="number" id="editPackagePrice" required style="width: 100%; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: white; font-size: 14px;" value="${pkg.price}" min="0" step="0.01">
                        </div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button type="button" onclick="closeEditPackageModal()" style="flex: 1; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: white; font-weight: 500; cursor: pointer; font-size: 14px;">Cancel</button>
                            <button type="submit" style="flex: 1; padding: 10px; background: var(--admin-color); border: none; border-radius: 6px; color: white; font-weight: 600; cursor: pointer; font-size: 14px;">Update Package</button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.getElementById('editPackageName').focus();
            
            modal.querySelector('#editPackageForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const name = document.getElementById('editPackageName').value;
                const price = parseFloat(document.getElementById('editPackagePrice').value);
                
                if (!name || price <= 0) {
                    showError('Please fill in all required fields');
                    return;
                }
                
                pkg.name = name;
                pkg.price = price;
                pkg.updatedAt = new Date().toLocaleDateString();
                
                savePackages();
                
                closeEditPackageModal();
                showPackagesSection();
                showSuccess(`Package "${name}" updated successfully!`);
            });
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeEditPackageModal();
                }
            });
        }
        
        function closeEditPackageModal() {
            const modal = document.querySelector('div[style*="z-index: 10001"]');
            if (modal) {
                modal.remove();
            }
        }
        
        function editAddon(addonId) {
            const addon = window.addons.find(a => a.id === addonId);
            if (!addon) return;
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 10001;
                display: flex;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(10px);
            `;
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #1a1a2e, #16213e); padding: 30px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.2); width: 400px;">
                    <h3 style="color: white; margin-bottom: 20px; text-align: center;">‚úèÔ∏è Edit Addon</h3>
                    
                    <form id="editAddonForm">
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: white; font-size: 14px;">Addon Name *</label>
                            <input type="text" id="editAddonName" required style="width: 100%; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: white; font-size: 14px;" value="${addon.name}">
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 5px; color: white; font-size: 14px;">Monthly Price ($) *</label>
                            <input type="number" id="editAddonPrice" required style="width: 100%; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: white; font-size: 14px;" value="${addon.price}" min="0" step="0.01">
                        </div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button type="button" onclick="closeEditAddonModal()" style="flex: 1; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: white; font-weight: 500; cursor: pointer; font-size: 14px;">Cancel</button>
                            <button type="submit" style="flex: 1; padding: 10px; background: #ff9800; border: none; border-radius: 6px; color: white; font-weight: 600; cursor: pointer; font-size: 14px;">Update Addon</button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.getElementById('editAddonName').focus();
            
            modal.querySelector('#editAddonForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const name = document.getElementById('editAddonName').value;
                const price = parseFloat(document.getElementById('editAddonPrice').value);
                
                if (!name || price <= 0) {
                    showError('Please fill in all required fields');
                    return;
                }
                
                addon.name = name;
                addon.price = price;
                addon.updatedAt = new Date().toLocaleDateString();
                
                saveAddons();
                
                closeEditAddonModal();
                showPackagesSection();
                showSuccess(`Addon "${name}" updated successfully!`);
            });
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeEditAddonModal();
                }
            });
        }
        
        function closeEditAddonModal() {
            const modal = document.querySelector('div[style*="z-index: 10001"]');
            if (modal) {
                modal.remove();
            }
        }
        
        function deleteCustomer(username) {
            if (confirm(`Are you sure you want to delete customer "${username}"? This action cannot be undone.`)) {
                showSuccess(`Customer "${username}" has been deleted`);
            }
        }
        
        function suspendCustomer(username) {
            if (confirm(`Suspend customer "${username}"?`)) {
                showSuccess(`Customer "${username}" has been suspended`);
            }
        }
        
        function viewCustomerDetails(username) {
            alert(`Customer Details: ${username}\n\nStatus: Active\nPlan: Premium\nDevices: 3/4\nLast Login: 2025-11-12\nSubscription: Until 2025-12-12\nRevenue: $29.99/month`);
        }
        
        // Initialize customer data from localStorage
        function initializeAdminCustomers() {
            const saved = localStorage.getItem('adminCustomers');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    // Convert to the format expected by the code
                    window.adminUsers = parsed;
                } catch (e) {
                    console.error('Error parsing saved customers:', e);
                    window.adminUsers = [];
                }
            } else {
                window.adminUsers = [];
            }
        }
        
        // Save customers to localStorage
        function saveAdminCustomers() {
            try {
                smartStorage.setItem('adminCustomers', window.adminUsers);
                console.log('‚úÖ Customers saved with cloud sync');
            } catch (e) {
                console.error('Error saving customers:', e);
            }
        }
        
        // Enhanced Credit Management System - UNLIMITED TRANSFERS & BUSINESS WORKFLOW
        const creditSystem = {
            resellerCredits: {},
            transactionHistory: [],
            resellerInfo: {}, // Store reseller details and settings
            
            initializeCredits: function() {
                // Load existing reseller wallet data (simple number format)
                const savedWallet = localStorage.getItem('resellerWallet');
                if (savedWallet) {
                    try {
                        const balance = parseFloat(savedWallet);
                        this.resellerCredits = { 'reseller': balance || 0 };
                    } catch (e) {
                        console.error('Error loading reseller wallet:', e);
                        this.resellerCredits = { 'reseller': 0 };
                    }
                } else {
                    this.resellerCredits = { 'reseller': 0 };
                }
                
                // Load transaction history
                const savedTransactions = localStorage.getItem('creditTransactions');
                if (savedTransactions) {
                    try {
                        this.transactionHistory = JSON.parse(savedTransactions);
                    } catch (e) {
                        console.error('Error loading transactions:', e);
                        this.transactionHistory = [];
                    }
                } else {
                    this.transactionHistory = [];
                }
                
                console.log('Credits system initialized - loaded existing data');
            },
            
            saveCredits: function() {
                // Save all reseller credits in structured format
                Object.keys(this.resellerCredits).forEach(resellerId => {
                    const balance = this.resellerCredits[resellerId];
                    localStorage.setItem(`resellerWallet_${resellerId}`, balance.toFixed(2));
                });
                
                localStorage.setItem('creditTransactions', JSON.stringify(this.transactionHistory));
                localStorage.setItem('resellerCredits', JSON.stringify(this.resellerCredits));
                localStorage.setItem('resellerInfo', JSON.stringify(this.resellerInfo));
                
                console.log('üí≥ ADMIN: Enhanced credit system saved for all resellers');
                
                // Trigger reseller panel sync
                localStorage.setItem('packagesUpdated', Date.now().toString());
            },
            
            getRequiredBasicPackage: function() {
                return 'basic_tv'; // The basic package ID that must be sold first
            },
            
            validateSale: function(selectedPackages, selectedAddons = []) {
                const requiredBasic = this.getRequiredBasicPackage();
                const hasBasic = selectedPackages.includes(requiredBasic);
                
                if (!hasBasic) {
                    return {
                        valid: false,
                        message: '‚ùå Basic TV Package must be sold first before any add-ons or additional TV packages',
                        missing: 'Basic TV Package'
                    };
                }
                
                // Check if any additional packages require basic (they should by design)
                const additionalPackages = selectedPackages.filter(pkg => pkg !== requiredBasic);
                if (additionalPackages.length > 0 && !hasBasic) {
                    return {
                        valid: false,
                        message: '‚ùå Additional packages require Basic TV Package',
                        missing: 'Basic TV Package'
                    };
                }
                
                return { valid: true, message: '‚úÖ Sale is valid' };
            },
            
            calculateSaleCost: function(selectedPackages, selectedAddons = []) {
                let totalCost = 0;
                
                // Calculate package costs
                selectedPackages.forEach(packageId => {
                    const pkg = window.packages.find(p => p.id === packageId);
                    if (pkg) {
                        totalCost += pkg.price;
                    }
                });
                
                // Calculate addon costs
                selectedAddons.forEach(addonId => {
                    const addon = window.addons.find(a => a.id === addonId);
                    if (addon) {
                        totalCost += addon.price;
                    }
                });
                
                return totalCost;
            },
            
            // ENHANCED TRANSFER - Create reseller profile if doesn't exist
            transferCredit: function(resellerId, amount, description = 'Credit Transfer', resellerName = '') {
                amount = parseFloat(amount);
                if (isNaN(amount) || amount <= 0) {
                    return { success: false, message: 'Invalid amount' };
                }
                
                if (!resellerId || resellerId.trim() === '') {
                    return { success: false, message: 'Reseller ID is required' };
                }
                
                if (!this.resellerCredits[resellerId]) {
                    this.resellerCredits[resellerId] = 0;
                    
                    // Create reseller profile if new
                    this.resellerInfo[resellerId] = {
                        name: resellerName || resellerId,
                        createdAt: new Date().toISOString(),
                        totalTransferred: 0,
                        totalSales: 0,
                        status: 'active'
                    };
                }
                
                // UNLIMITED TRANSFER - Direct credit addition
                this.resellerCredits[resellerId] += amount;
                this.resellerInfo[resellerId].totalTransferred += amount;
                
                // Log transaction
                const transaction = {
                    id: 'TXN' + Date.now(),
                    type: 'transfer',
                    from: 'admin',
                    to: resellerId,
                    amount: amount,
                    description: description,
                    timestamp: new Date().toISOString(),
                    date: new Date().toLocaleString()
                };
                this.transactionHistory.unshift(transaction);
                
                this.saveCredits();
                return { success: true, message: `Successfully transferred $${amount} to ${resellerId}` };
            },
            
            getResellerBalance: function(resellerId) {
                return this.resellerCredits[resellerId] || 0;
            }
        };
        
        // Force clear demo data immediately
        creditSystem.initializeCredits();
        
        function showCreditSection() {
            const mainContent = document.querySelector('.admin-main');
            const resellerList = Object.keys(creditSystem.resellerCredits).map(resellerId => {
                const balance = creditSystem.getResellerBalance(resellerId);
                return `
                    <div style="background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; padding: 15px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h4 style="color: white; margin: 0 0 5px 0;">${resellerId}</h4>
                            <p style="color: rgba(255,255,255,0.7); margin: 0;">Current Balance: $${balance}</p>
                        </div>
                        <div>
                            <button onclick="transferCreditModal('${resellerId}')" style="background: var(--admin-color); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; margin-right: 10px;">Transfer</button>
                            <button onclick="viewCreditHistory('${resellerId}')" style="background: rgba(255,255,255,0.2); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">History</button>
                        </div>
                    </div>
                `;
            }).join('');
            
            mainContent.innerHTML = `
                <div class="dashboard-header">
                    <h1 class="dashboard-title">üí≥ Credit Manager</h1>
                    <p class="dashboard-subtitle">Unlimited transfers to reseller wallets</p>
                </div>
                
                <!-- Transfer Control Card -->
                <div style="background: linear-gradient(135deg, #2c3e50, #34495e); border-radius: 12px; padding: 25px; margin-bottom: 30px; text-align: center; border: 1px solid rgba(255,255,255,0.2);">
                    <h3 style="color: white; margin-bottom: 10px;">üí∞ Credit Transfer System</h3>
                    <div style="font-size: 1.2rem; font-weight: 600; color: var(--admin-color); margin-bottom: 15px;">Unlimited Transfers</div>
                    <button onclick="transferCreditModal()" style="background: var(--admin-color); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 16px;">üí≥ Transfer to Reseller</button>
                </div>
                
                <!-- Reseller Credits -->
                <div style="background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.2); border-radius: 12px; padding: 25px;">
                    <h3 style="color: white; margin-bottom: 20px;">üè¢ Reseller Credits</h3>
                    ${resellerList || '<p style="color: rgba(255,255,255,0.7);">No resellers found. Make your first transfer to create a reseller account.</p>'}
                </div>
                
                <!-- Recent Transactions -->
                <div style="background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.2); border-radius: 12px; padding: 25px; margin-top: 30px;">
                    <h3 style="color: white; margin-bottom: 20px;">üìä Recent Transactions</h3>
                    ${generateCreditTransactions()}
                </div>
            `;
        }
        
        function generateCreditTransactions() {
            if (creditSystem.transactionHistory.length === 0) {
                return '<p style="color: rgba(255,255,255,0.7);">No transactions yet</p>';
            }
            
            return creditSystem.transactionHistory.slice(0, 10).map(tx => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <div>
                        <div style="color: white; font-weight: 500;">${tx.description}</div>
                        <div style="color: rgba(255,255,255,0.7); font-size: 0.9em;">${tx.date}</div>
                    </div>
                    <div style="color: #4caf50; font-weight: 600;">
                        +$${tx.amount}
                    </div>
                </div>
            `).join('');
        }
        
        function transferCreditModal(resellerId = 'reseller') {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 10001;
                display: flex;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(10px);
            `;
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #2c3e50, #34495e); padding: 40px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.2); width: 400px;">
                    <h2 style="color: white; margin-bottom: 20px; text-align: center;">üí≥ Transfer Credit</h2>
                    <div style="margin-bottom: 20px;">
                        <label style="color: white; display: block; margin-bottom: 8px;">Reseller ID *</label>
                        <input type="text" id="transferResellerId" value="${resellerId}" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.3); color: white;" placeholder="reseller" required>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="color: white; display: block; margin-bottom: 8px;">Amount ($) *</label>
                        <input type="number" id="transferAmount" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.3); color: white;" placeholder="Enter amount" value="" min="0.01" step="0.01" required>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="color: white; display: block; margin-bottom: 8px;">Description</label>
                        <input type="text" id="transferDescription" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.3); color: white;" placeholder="Optional description">
                    </div>
                    <div style="margin-bottom: 20px; text-align: center;">
                        <span style="color: rgba(255,255,255,0.7);">Transfer Type: </span>
                        <span style="color: var(--admin-color); font-weight: 600;">Unlimited</span>
                    </div>
                    <div style="display: flex; gap: 15px;">
                        <button onclick="confirmTransfer()" style="flex: 1; background: var(--admin-color); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: 500;">Transfer</button>
                        <button onclick="closeModal()" style="flex: 1; background: rgba(255,255,255,0.2); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer;">Cancel</button>
                    </div>
                </div>
            `;
            
            // Store modal reference globally for confirmTransfer function
            window.currentTransferModal = modal;
            document.body.appendChild(modal);
            
            // Add event listeners
            document.getElementById('transferAmount').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') confirmTransfer();
            });
            
            // Focus on first input
            document.getElementById('transferResellerId').focus();
        }
        
        function confirmTransfer() {
            const resellerId = document.getElementById('transferResellerId').value.trim();
            const amount = document.getElementById('transferAmount').value;
            const description = document.getElementById('transferDescription').value || 'Credit Transfer';
            
            console.log('üí≥ ADMIN: Transfer initiated - Reseller: ' + resellerId + ', Amount: $' + amount + ', Description: ' + description);
            
            if (!resellerId) {
                alert('Please enter reseller ID');
                return;
            }
            
            if (!amount || parseFloat(amount) <= 0) {
                alert('Please enter a valid amount');
                return;
            }
            
            const result = creditSystem.transferCredit(resellerId, amount, description);
            
            if (result.success) {
                console.log('üí≥ ADMIN: Transfer completed successfully - ' + result.message);
                alert(result.message);
                closeModal();
                showCreditSection(); // Refresh the section
            } else {
                console.log('üí≥ ADMIN: Transfer failed - ' + result.message);
                alert('Error: ' + result.message);
            }
        }
        
        function viewCreditHistory(resellerId) {
            const transactions = creditSystem.transactionHistory.filter(tx => tx.to === resellerId || tx.from === resellerId);
            
            if (transactions.length === 0) {
                alert(`No transactions found for ${resellerId}`);
                return;
            }
            
            const historyText = transactions.slice(0, 20).map(tx => 
                `[${tx.date}] ${tx.description} - $${tx.amount}`
            ).join('\n');
            
            alert(`Credit History for ${resellerId}:\n\n${historyText}`);
        }
        
        function closeModal() {
            if (window.currentTransferModal) {
                document.body.removeChild(window.currentTransferModal);
                window.currentTransferModal = null;
            }
        }
        
        // Check login status on page load
        window.addEventListener('load', function() {
            console.log('üîß Initializing admin panel...');
            
            // Initialize password manager
            if (typeof passwordManager !== 'undefined') {
                passwordManager.initialize();
                console.log('‚úÖ Password manager initialized');
            } else {
                console.error('‚ùå Password manager not found');
            }
            
            loadAdminCustomers();
            initializePackages();
            initializeAddons();
            initializeDevicePricing();
            creditSystem.initializeCredits();
            showLogin();
            
            console.log('‚úÖ Admin panel initialized complete');
        });
    </script>
    
    <!-- Login Modal -->
    <div id="adminOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; backdrop-filter: blur(10px);">
        <div id="loginModal" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(135deg, #1a1a2e, #16213e); padding: 40px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.2); width: 400px; text-align: center;">
            <h2 style="color: white; margin-bottom: 30px; font-size: 24px;">üîê Admin Login</h2>
            <input type="text" id="adminUsername" placeholder="Username" style="width: 100%; padding: 12px; margin-bottom: 15px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;">
            <input type="password" id="adminPassword" placeholder="Password" style="width: 100%; padding: 12px; margin-bottom: 20px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white;" onkeypress="if(event.key==='Enter'){adminLogin()}">
            <button onclick="adminLogin()" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #4caf50, #66bb6a); border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer; margin-bottom: 10px;">Login</button>
        </div>
    </div>
    
    <!-- No Flash Navigation -->
    <div class="admin-header-top" style="position: fixed; top: 0; left: 0; right: 0; background: rgba(0,0,0,0.9); padding: 15px; z-index: 999; display: flex; justify-content: space-between; align-items: center;">
        <div style="color: white; font-weight: 600;">üîß Admin Panel - iWATCH TV</div>
        <div>
            <span id="adminUserInfo" style="color: rgba(255,255,255,0.7); margin-right: 15px;"></span>
            <button onclick="logout()" style="background: #f44336; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">Logout</button>
        </div>
    </div>




<body style="padding-top: 60px;">

<script>
// Load existing reseller wallet data on page load
creditSystem.initializeCredits();
showCreditSection(); // Initialize credit section with loaded data

// Mobile Menu Toggle Functionality
function toggleMobileMenu() {
    const sidebar = document.getElementById('mobileSidebar');
    sidebar.classList.toggle('active');
}

// Dashboard Section
function showDashboard() {
    const mainContent = document.querySelector('.admin-main');
    mainContent.innerHTML = `
        <div class="dashboard-header">
            <h1 class="dashboard-title">üìä Dashboard Overview</h1>
            <p class="dashboard-subtitle">Welcome to iWATCH TV Admin Panel</p>
        </div>
        
        <!-- Statistics Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon users">üë•</div>
                <div class="stat-value">247</div>
                <div class="stat-label">Total Users</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon content">üì∫</div>
                <div class="stat-value">1,234</div>
                <div class="stat-label">Content Items</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon revenue">üí∞</div>
                <div class="stat-value">$12,450</div>
                <div class="stat-label">Monthly Revenue</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon system">üñ•Ô∏è</div>
                <div class="stat-value">99.9%</div>
                <div class="stat-label">System Uptime</div>
            </div>
        </div>
    `;
    
    // Close mobile menu if open
    if (window.innerWidth <= 768) {
        document.getElementById('mobileSidebar').classList.remove('active');
    }
}

// Close mobile menu when clicking on main content
function showSection(sectionName) {
    const sidebar = document.getElementById('mobileSidebar');
    if (window.innerWidth <= 768) {
        sidebar.classList.remove('active');
    }
    // Call original showSection function
    if (sectionName === 'dashboard') showDashboard();
    else if (sectionName === 'users') showUsersSection();
    else if (sectionName === 'content') showContentSection();
    else if (sectionName === 'packages') showPackagesSection();
    else if (sectionName === 'resellers') showResellersSection();
    else if (sectionName === 'analytics') showAnalyticsSection();
    else if (sectionName === 'settings') showSettingsSection();
    else if (sectionName === 'logs') showLogsSection();
    else if (sectionName === 'credits') showCreditSection();
}

// Close mobile menu when clicking outside
document.addEventListener('click', function(event) {
    const sidebar = document.getElementById('mobileSidebar');
    const toggle = document.querySelector('.mobile-menu-toggle');
    
    if (window.innerWidth <= 768 && 
        sidebar.classList.contains('active') && 
        !sidebar.contains(event.target) && 
        !toggle.contains(event.target)) {
        sidebar.classList.remove('active');
    }
});

// Auto-close mobile menu on window resize
window.addEventListener('resize', function() {
    if (window.innerWidth > 768) {
        document.getElementById('mobileSidebar').classList.remove('active');
    }
});
</script>

</body>
</html>